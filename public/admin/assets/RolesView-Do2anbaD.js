import{_ as E,e as G,x as m,h as o,a as e,k,v as S,d as U,t as r,F as y,i as b,j as q,l as D,g as u,q as I,o as n,A as T}from"./index-D8cdO5Bu.js";const j={class:"roles-permissions"},Q={class:"toolbar"},z={class:"search-box"},H={key:0,class:"loading"},J={key:1,class:"error-message"},K={key:2,class:"table-container"},O={class:"data-table"},W={class:"badge-list"},X={key:0,class:"text-muted"},Y={class:"actions"},Z=["onClick"],ee=["onClick"],se={class:"modal"},le={class:"modal-header"},te={class:"modal-body"},ae={class:"form-group"},oe={class:"form-group"},ne={key:0,class:"loading-text"},ie={key:1,class:"permissions-container"},re={class:"group-header"},de=["onClick"],ue={class:"permissions-grid"},ce=["value"],ve={class:"modal-footer"},me=["disabled"],pe={__name:"RolesView",setup(_e){const C=u([]),g=u(!1),c=u(null),x=u(""),p=u(!1),v=u(null),a=u({name:"",permissions:[]}),_=u(!1),w=u({}),R=u(!0),V=I(()=>w.value);G(()=>{f(),M()});const f=async()=>{var t,l;g.value=!0,c.value=null;try{const s=await m.get("/admin/roles");C.value=s.data}catch(s){c.value=((l=(t=s.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to load roles"}finally{g.value=!1}},M=async()=>{try{const t=await m.get("/admin/permissions");w.value=t.data}catch(t){console.error("Failed to load permissions:",t)}finally{R.value=!1}},N=()=>{v.value=null,a.value={name:"",permissions:[]},p.value=!0},F=t=>{var l;v.value=t,a.value={name:t.name,permissions:((l=t.permissions)==null?void 0:l.map(s=>s.name))||[]},p.value=!0},h=()=>{p.value=!1,v.value=null,a.value={name:"",permissions:[]}},$=async()=>{var t,l;_.value=!0;try{v.value?await m.patch(`/admin/roles/${v.value.id}`,a.value):await m.post("/admin/roles",a.value),h(),f()}catch(s){c.value=((l=(t=s.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to save role"}finally{_.value=!1}},P=async t=>{var l,s;if(confirm(`Delete role "${t.name}"?`))try{await m.delete(`/admin/roles/${t.id}`),f()}catch(d){c.value=((s=(l=d.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to delete role"}},A=(t,l)=>{const s=l.map(i=>i.name);s.every(i=>a.value.permissions.includes(i))?a.value.permissions=a.value.permissions.filter(i=>!s.includes(i)):a.value.permissions=[...new Set([...a.value.permissions,...s])]},B=(t,l)=>l.every(s=>a.value.permissions.includes(s.name));return(t,l)=>(n(),o("div",j,[e("div",Q,[e("div",z,[k(e("input",{"onUpdate:modelValue":l[0]||(l[0]=s=>x.value=s),type:"text",placeholder:"Search roles..."},null,512),[[S,x.value]])]),e("button",{onClick:N,class:"btn-primary"},[...l[3]||(l[3]=[e("span",null,"➕",-1),U(" Create Role ",-1)])])]),g.value?(n(),o("div",H,"Loading...")):c.value?(n(),o("div",J,r(c.value),1)):(n(),o("div",K,[e("table",O,[l[4]||(l[4]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Role Name"),e("th",null,"Permissions"),e("th",null,"Created"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),o(y,null,b(C.value,s=>{var d;return n(),o("tr",{key:s.id},[e("td",null,r(s.id),1),e("td",null,r(s.name),1),e("td",null,[e("div",W,[(n(!0),o(y,null,b(s.permissions,i=>(n(),o("span",{key:i.id,class:"badge"},r(i.name),1))),128)),(d=s.permissions)!=null&&d.length?D("",!0):(n(),o("span",X,"No permissions"))])]),e("td",null,r(new Date(s.created_at).toLocaleDateString()),1),e("td",Y,[e("button",{onClick:i=>F(s),class:"btn-sm btn-edit"},"Edit",8,Z),e("button",{onClick:i=>P(s),class:"btn-sm btn-delete"},"Delete",8,ee)])])}),128))])])])),p.value?(n(),o("div",{key:3,class:"modal-overlay",onClick:q(h,["self"])},[e("div",se,[e("div",le,[e("h2",null,r(v.value?"Edit":"Create")+" Role",1),e("button",{onClick:h,class:"close-btn"},"×")]),e("div",te,[e("div",ae,[l[5]||(l[5]=e("label",null,"Role Name",-1)),k(e("input",{"onUpdate:modelValue":l[1]||(l[1]=s=>a.value.name=s),type:"text",required:"",placeholder:"e.g., moderator, support",class:"form-input"},null,512),[[S,a.value.name]])]),e("div",oe,[e("label",null,"Permissions ("+r(a.value.permissions.length)+" selected)",1),R.value?(n(),o("div",ne,"Loading permissions...")):(n(),o("div",ie,[(n(!0),o(y,null,b(V.value,(s,d)=>(n(),o("div",{key:d,class:"permission-group"},[e("div",re,[e("h4",null,r(d),1),e("button",{onClick:i=>A(d,s),class:"btn-link",type:"button"},r(B(d,s)?"Deselect All":"Select All"),9,de)]),e("div",ue,[(n(!0),o(y,null,b(s,i=>(n(),o("label",{key:i.id,class:"permission-checkbox"},[k(e("input",{type:"checkbox",value:i.name,"onUpdate:modelValue":l[2]||(l[2]=L=>a.value.permissions=L)},null,8,ce),[[T,a.value.permissions]]),e("span",null,r(i.name),1)]))),128))])]))),128))]))])]),e("div",ve,[e("button",{onClick:h,class:"btn-secondary"},"Cancel"),e("button",{onClick:$,class:"btn-primary",disabled:_.value},r(_.value?"Saving...":"Save"),9,me)])])])):D("",!0)]))}},ye=E(pe,[["__scopeId","data-v-e95bd6a9"]]);export{ye as default};
