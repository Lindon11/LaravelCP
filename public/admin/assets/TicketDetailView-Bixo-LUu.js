import{_ as X,e as Y,h as o,a as e,d as k,t as i,l as h,n as u,F as H,i as W,k as N,v as Z,A as ee,x as d,g as c,E as se,y as te,u as ae,o as n}from"./index-DAZDm4is.js";const le={class:"ticket-detail"},ie={class:"page-header"},oe={key:0,class:"ticket-ref"},ne={key:0,class:"loading-state"},re={key:1,class:"error-state"},ue={key:2,class:"ticket-layout"},de={class:"main-panel"},ve={class:"info-card"},ce={class:"info-header"},pe={class:"info-title"},ge={class:"info-meta"},ke={class:"meta-item"},me={class:"meta-item"},we={class:"meta-item"},ye={key:0,class:"meta-item"},he={class:"message-card original"},fe={class:"message-avatar user"},_e={class:"message-content"},be={class:"message-header"},Ce={class:"sender-name"},xe={class:"message-time"},Me={class:"message-body"},Te={key:0,class:"replies-section"},Be={class:"section-title"},ze={class:"message-content"},Ve={class:"message-header"},Ae={class:"sender-name"},$e={key:0,class:"staff-badge"},Re={class:"message-time"},Se={class:"message-body"},Le={key:1,class:"reply-form"},Ue={class:"quick-replies-inline"},Fe=["onClick"],De={class:"form-group"},He={class:"form-actions"},We={class:"checkbox-wrapper"},Ne=["disabled"],Oe={key:2,class:"closed-notice"},Pe={class:"side-panel"},Ie={class:"panel-card"},qe={class:"button-grid"},Ee={class:"panel-card"},je={class:"button-grid"},Qe={class:"panel-card"},Ge={key:0,class:"assignee-info"},Je={class:"assignee-avatar"},Ke={class:"assignee-name"},Xe={__name:"TicketDetailView",setup(Ye){const O=se(),T=ae(),r=te(),f=c(!0),t=c(null),v=c(""),m=c(!1),_=c(!0),p=c(null),P=[{label:"Thanks for contacting",text:"Thank you for contacting support. We have received your ticket and will assist you shortly."},{label:"Issue resolved",text:"We have resolved the issue you reported. Please let us know if you need further assistance."},{label:"Need more info",text:"To help investigate further, could you please provide additional details about the issue?"},{label:"Working on it",text:"Our team is currently investigating this issue. We will update you soon."}],b=async()=>{f.value=!0;try{const a=await d.get(`/admin/support/tickets/${O.params.id}`);t.value=a.data.ticket||a.data.data||a.data}catch(a){console.error("Failed to fetch ticket:",a),r.error("Failed to load ticket"),t.value=null}finally{f.value=!1}},I=async()=>{try{const a=await d.get("/user");p.value=a.data}catch(a){console.error("Failed to fetch user:",a)}},B=()=>T.push("/tickets"),q=async()=>{if(v.value.trim()){m.value=!0;try{await d.post(`/admin/support/tickets/${t.value.id}/reply`,{message:v.value}),t.value.messages=t.value.messages||[],t.value.messages.push({id:Date.now(),message:v.value,is_admin:!0,user:p.value,created_at:new Date().toISOString()}),_.value&&t.value.status!=="answered"&&(t.value.status="answered",await d.patch(`/admin/support/tickets/${t.value.id}/status`,{status:"answered"})),v.value="",r.success("Reply sent")}catch{r.error("Failed to send reply")}finally{m.value=!1}}},g=async()=>{try{await d.patch(`/admin/support/tickets/${t.value.id}/status`,{status:t.value.status}),r.success("Status updated")}catch{r.error("Failed to update status"),b()}},w=async()=>{try{await d.patch(`/admin/support/tickets/${t.value.id}`,{priority:t.value.priority}),r.success("Priority updated")}catch{r.error("Failed to update priority"),b()}},E=async()=>{var a,s;try{await d.patch(`/admin/support/tickets/${t.value.id}/assign`,{assigned_to:(a=p.value)==null?void 0:a.id}),t.value.assigned_to=(s=p.value)==null?void 0:s.id,t.value.assigned_user=p.value,r.success("Ticket assigned to you")}catch{r.error("Failed to assign ticket")}},j=async()=>{try{await d.patch(`/admin/support/tickets/${t.value.id}/assign`,{assigned_to:null}),t.value.assigned_to=null,t.value.assigned_user=null,r.success("Ticket unassigned")}catch{r.error("Failed to unassign ticket")}},Q=async()=>{t.value.status="open",await g()},G=async()=>{if(confirm("Delete this ticket permanently?"))try{await d.delete(`/admin/support/tickets/${t.value.id}`),r.success("Ticket deleted"),T.push("/tickets")}catch{r.error("Failed to delete ticket")}},J=a=>{v.value=a},K=a=>({open:"Open",waiting_response:"Waiting",answered:"Answered",closed:"Closed"})[a]||a,C=a=>a?new Date(a).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"";return Y(()=>{b(),I()}),(a,s)=>{var x,z,V,A,$,R,S,L,U;return n(),o("div",le,[e("div",ie,[e("button",{class:"back-btn",onClick:B},[...s[10]||(s[10]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),k(" Back ",-1)])]),t.value?(n(),o("span",oe,"Ticket #"+i(t.value.id),1)):h("",!0)]),f.value?(n(),o("div",ne,[...s[11]||(s[11]=[e("div",{class:"spinner"},null,-1),e("span",null,"Loading ticket...",-1)])])):t.value?(n(),o("div",ue,[e("div",de,[e("div",ve,[e("div",ce,[e("div",pe,[e("h2",null,i(t.value.subject),1),e("span",{class:u(["priority-tag",t.value.priority])},i(t.value.priority),3)]),e("span",{class:u(["status-tag",t.value.status])},i(K(t.value.status)),3)]),e("div",ge,[e("div",ke,[s[15]||(s[15]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1)),e("span",null,i(((x=t.value.user)==null?void 0:x.username)||"Unknown"),1)]),e("div",me,[s[16]||(s[16]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),e("path",{d:"m22 6-10 7L2 6"})],-1)),e("span",null,i(((z=t.value.user)==null?void 0:z.email)||"No email"),1)]),e("div",we,[s[17]||(s[17]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),e("path",{d:"M16 2v4M8 2v4M3 10h18"})],-1)),e("span",null,i(C(t.value.created_at)),1)]),t.value.category?(n(),o("div",ye,[s[18]||(s[18]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})],-1)),e("span",null,i((V=t.value.category)==null?void 0:V.name),1)])):h("",!0)])]),e("div",he,[e("div",fe,i(((R=($=(A=t.value.user)==null?void 0:A.username)==null?void 0:$.charAt(0))==null?void 0:R.toUpperCase())||"?"),1),e("div",_e,[e("div",be,[e("span",Ce,i(((S=t.value.user)==null?void 0:S.username)||"User"),1),e("span",xe,i(C(t.value.created_at)),1)]),e("div",Me,i(t.value.description||t.value.message),1)])]),t.value.messages&&t.value.messages.length>0?(n(),o("div",Te,[e("h4",Be,[s[19]||(s[19]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})],-1)),k(" "+i(t.value.messages.length)+" "+i(t.value.messages.length===1?"Reply":"Replies"),1)]),(n(!0),o(H,null,W(t.value.messages,l=>{var y,M,F,D;return n(),o("div",{key:l.id,class:u(["message-card",{admin:l.is_admin||l.is_staff_reply}])},[e("div",{class:u(["message-avatar",l.is_admin||l.is_staff_reply?"admin":"user"])},i(((F=(M=(y=l.user)==null?void 0:y.username)==null?void 0:M.charAt(0))==null?void 0:F.toUpperCase())||"?"),3),e("div",ze,[e("div",Ve,[e("span",Ae,[k(i(((D=l.user)==null?void 0:D.username)||"Unknown")+" ",1),l.is_admin||l.is_staff_reply?(n(),o("span",$e,"Staff")):h("",!0)]),e("span",Re,i(C(l.created_at)),1)]),e("div",Se,i(l.message),1)])],2)}),128))])):h("",!0),t.value.status!=="closed"?(n(),o("div",Le,[s[21]||(s[21]=e("h4",{class:"section-title"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})]),k(" Send Reply ")],-1)),e("div",Ue,[(n(),o(H,null,W(P,(l,y)=>e("button",{key:y,onClick:M=>J(l.text),class:"quick-reply-btn"},i(l.label),9,Fe)),64))]),e("div",De,[N(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=l=>v.value=l),placeholder:"Type your response...",rows:"4"},null,512),[[Z,v.value]])]),e("div",He,[e("label",We,[N(e("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=l=>_.value=l)},null,512),[[ee,_.value]]),s[20]||(s[20]=e("span",null,"Mark as answered",-1))]),e("button",{class:"btn-primary",onClick:q,disabled:!v.value.trim()||m.value},i(m.value?"Sending...":"Send Reply"),9,Ne)])])):(n(),o("div",Oe,[s[22]||(s[22]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)),s[23]||(s[23]=e("p",null,"This ticket is closed",-1)),e("button",{class:"btn-secondary",onClick:Q},"Reopen Ticket")]))]),e("div",Pe,[e("div",Ie,[s[28]||(s[28]=e("h5",null,"Status",-1)),e("div",qe,[e("button",{class:u(["status-btn",{active:t.value.status==="open","status-open":t.value.status==="open"}]),onClick:s[2]||(s[2]=l=>{t.value.status="open",g()})},[...s[24]||(s[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule":"evenodd"})],-1),e("span",null,"Open",-1)])],2),e("button",{class:u(["status-btn",{active:t.value.status==="waiting_response","status-waiting":t.value.status==="waiting_response"}]),onClick:s[3]||(s[3]=l=>{t.value.status="waiting_response",g()})},[...s[25]||(s[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z","clip-rule":"evenodd"})],-1),e("span",null,"Waiting",-1)])],2),e("button",{class:u(["status-btn",{active:t.value.status==="answered","status-answered":t.value.status==="answered"}]),onClick:s[4]||(s[4]=l=>{t.value.status="answered",g()})},[...s[26]||(s[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M3.505 2.365A41.369 41.369 0 019 2c1.863 0 3.697.124 5.495.365 1.247.167 2.18 1.108 2.435 2.268a4.45 4.45 0 00-.577-.069 43.141 43.141 0 00-4.706 0C9.229 4.696 7.5 6.727 7.5 8.998v2.24c0 1.413.67 2.735 1.76 3.562l-2.98 2.98A.75.75 0 015 17.25v-3.443c-.501-.048-1-.106-1.495-.172C2.033 13.438 1 12.162 1 10.72V5.28c0-1.441 1.033-2.717 2.505-2.914z"}),e("path",{d:"M14 6c-.762 0-1.52.02-2.271.062C10.157 6.148 9 7.472 9 8.998v2.24c0 1.519 1.147 2.839 2.71 2.935.214.013.428.024.642.034.2.009.385.09.518.224l2.35 2.35a.75.75 0 001.28-.531v-2.07c1.453-.195 2.5-1.463 2.5-2.915V8.998c0-1.526-1.157-2.85-2.729-2.936A41.645 41.645 0 0014 6z"})],-1),e("span",null,"Answered",-1)])],2),e("button",{class:u(["status-btn",{active:t.value.status==="closed","status-closed":t.value.status==="closed"}]),onClick:s[5]||(s[5]=l=>{t.value.status="closed",g()})},[...s[27]||(s[27]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z","clip-rule":"evenodd"})],-1),e("span",null,"Closed",-1)])],2)])]),e("div",Ee,[s[33]||(s[33]=e("h5",null,"Priority",-1)),e("div",je,[e("button",{class:u(["priority-btn",{active:t.value.priority==="low","priority-low":t.value.priority==="low"}]),onClick:s[6]||(s[6]=l=>{t.value.priority="low",w()})},[...s[29]||(s[29]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z","clip-rule":"evenodd"})],-1),e("span",null,"Low",-1)])],2),e("button",{class:u(["priority-btn",{active:t.value.priority==="medium","priority-medium":t.value.priority==="medium"}]),onClick:s[7]||(s[7]=l=>{t.value.priority="medium",w()})},[...s[30]||(s[30]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 3a.75.75 0 01.55.24l3.25 3.5a.75.75 0 11-1.1 1.02L10 4.852 7.3 7.76a.75.75 0 01-1.1-1.02l3.25-3.5A.75.75 0 0110 3zm-3.76 9.2a.75.75 0 011.06.04l2.7 2.908 2.7-2.908a.75.75 0 111.1 1.02l-3.25 3.5a.75.75 0 01-1.1 0l-3.25-3.5a.75.75 0 01.04-1.06z","clip-rule":"evenodd"})],-1),e("span",null,"Medium",-1)])],2),e("button",{class:u(["priority-btn",{active:t.value.priority==="high","priority-high":t.value.priority==="high"}]),onClick:s[8]||(s[8]=l=>{t.value.priority="high",w()})},[...s[31]||(s[31]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z","clip-rule":"evenodd"})],-1),e("span",null,"High",-1)])],2),e("button",{class:u(["priority-btn",{active:t.value.priority==="urgent","priority-urgent":t.value.priority==="urgent"}]),onClick:s[9]||(s[9]=l=>{t.value.priority="urgent",w()})},[...s[32]||(s[32]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 103 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 002.273 1.765 11.842 11.842 0 00.976.544l.062.029.018.008.006.003zM10 11.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z","clip-rule":"evenodd"})],-1),e("span",null,"Urgent",-1)])],2)])]),e("div",Qe,[s[35]||(s[35]=e("h5",null,"Assigned To",-1)),t.value.assigned_user?(n(),o("div",Ge,[e("div",Je,i((U=(L=t.value.assigned_user.username)==null?void 0:L.charAt(0))==null?void 0:U.toUpperCase()),1),e("span",Ke,i(t.value.assigned_user.username),1),e("button",{class:"btn-icon",onClick:j,title:"Remove"},[...s[34]||(s[34]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])):(n(),o("button",{key:1,class:"btn-outline full",onClick:E}," Assign to Me "))]),e("div",{class:"panel-card danger"},[s[37]||(s[37]=e("h5",null,"Actions",-1)),e("button",{class:"btn-danger full",onClick:G},[...s[36]||(s[36]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1),k(" Delete Ticket ",-1)])])])])])):(n(),o("div",re,[s[12]||(s[12]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 8v4M12 16h.01"})],-1)),s[13]||(s[13]=e("h3",null,"Ticket not found",-1)),s[14]||(s[14]=e("p",null,"This ticket may have been deleted",-1)),e("button",{class:"btn-primary",onClick:B},"Return to Tickets")]))])}}},es=X(Xe,[["__scopeId","data-v-255deccd"]]);export{es as default};
