import{_ as ce,e as ue,x as b,h as o,a as e,b as u,z as m,H as G,k as F,v as B,d as H,V as me,t as n,F as _,i as w,P as I,l as R,c as ve,w as Q,T as Y,S as pe,g as c,q as Z,o as a,Y as be,E as xe,D as J,Z as fe,y as he}from"./index-DL7Vp4x-.js";import{r as ge}from"./PlusIcon-DK2kefzg.js";import{r as ye}from"./PencilIcon-BddmAyto.js";import{r as _e}from"./CheckCircleIcon-hwcxwIbu.js";const we={class:"space-y-6"},ke={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4"},Ce={class:"relative w-full sm:w-80"},Re={key:0,class:"rounded-2xl bg-slate-800/50 backdrop-blur border border-slate-700/50 p-12"},$e={key:1,class:"rounded-2xl bg-red-500/10 border border-red-500/30 p-6"},je={class:"flex items-center gap-3"},Ue={class:"text-red-400 font-medium"},Se={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-6"},Fe={class:"flex items-start justify-between mb-4"},Te={class:"flex items-center gap-3"},Ve={class:"w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center"},Me={class:"font-semibold text-white group-hover:text-amber-400 transition-colors"},Ne={class:"text-xs text-slate-400"},De={class:"flex items-center gap-1"},Ae=["onClick"],Pe=["onClick"],Be=["onClick"],Le={class:"space-y-3"},qe={class:"flex items-center justify-between"},ze={class:"text-xs font-medium text-slate-500"},Ee={key:0,class:"flex flex-wrap gap-1.5"},Ge={key:0,class:"px-2 py-1 text-xs font-medium rounded-md bg-amber-500/20 text-amber-400"},He={key:1,class:"text-sm text-slate-500 italic"},Ie={key:0,class:"col-span-full flex flex-col items-center justify-center py-12"},Qe={class:"w-16 h-16 rounded-2xl bg-slate-700/30 flex items-center justify-center mb-4"},Ye={class:"text-slate-400 text-center max-w-sm"},Ze={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Je={class:"relative bg-slate-800 border border-slate-700 rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col"},Ke={class:"flex items-center justify-between p-6 border-b border-slate-700 shrink-0"},Oe={class:"text-lg font-bold text-white"},We={class:"p-6 overflow-y-auto flex-1 space-y-6"},Xe={class:"space-y-2"},es={class:"space-y-3"},ss={class:"flex items-center justify-between"},ts={class:"text-xs text-slate-400"},ls={key:0,class:"flex items-center justify-center py-8"},as={key:1,class:"space-y-4 max-h-[400px] overflow-y-auto p-4 bg-slate-900/30 rounded-xl border border-slate-700/50"},os={class:"flex items-center justify-between sticky top-0 bg-slate-900/90 backdrop-blur py-2 -mx-2 px-2"},rs={class:"text-sm font-semibold text-amber-400 uppercase tracking-wider"},ns=["onClick"],is={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2"},ds=["value"],cs={class:"text-sm text-slate-300"},us={class:"flex items-center justify-end gap-3 p-6 border-t border-slate-700 bg-slate-800/50 shrink-0"},ms=["disabled"],vs={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},ps={class:"relative bg-slate-800 border border-slate-700 rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col"},bs={class:"flex items-center justify-between p-6 border-b border-slate-700 shrink-0"},xs={class:"text-lg font-bold text-white"},fs={class:"p-6 overflow-y-auto flex-1 space-y-6"},hs={class:"relative"},gs={key:0,class:"flex items-center justify-center py-8"},ys={key:1,class:"space-y-2"},_s={class:"flex items-center gap-3"},ws={class:"w-10 h-10 rounded-lg bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center text-white font-bold"},ks={class:"text-white font-medium"},Cs={class:"text-xs text-slate-400"},Rs=["onClick","disabled"],$s={key:2,class:"text-slate-500 text-center py-4"},js={key:0},Us={class:"space-y-2 max-h-64 overflow-y-auto"},Ss={class:"flex items-center gap-3"},Fs={class:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold"},Ts={class:"text-white font-medium"},Vs={class:"text-xs text-slate-400"},Ms=["onClick","disabled"],Ns={key:1,class:"text-emerald-400 text-sm flex items-center gap-1"},Ds={__name:"RolesView",setup(As){const v=he(),T=c([]),V=c(!1),$=c(null),k=c(""),j=c(!1),h=c(null),d=c({name:"",permissions:[]}),U=c(!1),L=c({}),q=c(!0),M=c(!1),x=c(null),C=c([]),f=c(""),g=c([]),N=c(!1),y=c(!1);let z=null;const K=Z(()=>L.value),E=Z(()=>k.value?T.value.filter(t=>t.name.toLowerCase().includes(k.value.toLowerCase())):T.value);ue(()=>{D(),O()});const D=async()=>{var t,s;V.value=!0,$.value=null;try{const l=await b.get("/admin/roles");T.value=l.data}catch(l){$.value=((s=(t=l.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to load roles"}finally{V.value=!1}},O=async()=>{try{const t=await b.get("/admin/permissions");L.value=t.data}catch(t){console.error("Failed to load permissions:",t)}finally{q.value=!1}},W=()=>{h.value=null,d.value={name:"",permissions:[]},j.value=!0},X=t=>{var s;h.value=t,d.value={name:t.name,permissions:((s=t.permissions)==null?void 0:s.map(l=>l.name))||[]},j.value=!0},S=()=>{j.value=!1,h.value=null,d.value={name:"",permissions:[]}},ee=async()=>{var t,s;if(!d.value.name){v.error("Role name is required");return}U.value=!0;try{h.value?(await b.patch(`/admin/roles/${h.value.id}`,d.value),v.success("Role updated")):(await b.post("/admin/roles",d.value),v.success("Role created")),S(),D()}catch(l){v.error(((s=(t=l.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to save role")}finally{U.value=!1}},se=async t=>{var s,l;if(confirm(`Delete role "${t.name}"?`))try{await b.delete(`/admin/roles/${t.id}`),v.success("Role deleted"),D()}catch(r){v.error(((l=(s=r.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to delete role")}},te=(t,s)=>{const l=s.map(i=>i.name);l.every(i=>d.value.permissions.includes(i))?d.value.permissions=d.value.permissions.filter(i=>!l.includes(i)):d.value.permissions=[...new Set([...d.value.permissions,...l])]},le=(t,s)=>s.every(l=>d.value.permissions.includes(l.name)),ae=t=>t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A",oe=async t=>{x.value=t,M.value=!0,f.value="",g.value=[],await P()},A=()=>{M.value=!1,x.value=null,C.value=[],f.value="",g.value=[]},P=async()=>{if(x.value){N.value=!0;try{const t=await b.get(`/admin/users?role=${x.value.name}`);C.value=t.data.data||t.data||[]}catch(t){console.error("Failed to load role users:",t),v.error("Failed to load users")}finally{N.value=!1}}},re=()=>{if(clearTimeout(z),!f.value||f.value.length<2){g.value=[];return}z=setTimeout(async()=>{try{const t=await b.get(`/admin/users?search=${f.value}`);g.value=t.data.data||t.data||[]}catch(t){console.error("Failed to search users:",t)}},300)},ne=t=>C.value.some(s=>s.id===t.id),ie=async t=>{var s,l;y.value=!0;try{await b.post(`/admin/users/${t.id}/roles`,{role:x.value.name}),v.success(`Role assigned to ${t.username}`),await P(),g.value=[],f.value=""}catch(r){v.error(((l=(s=r.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to assign role")}finally{y.value=!1}},de=async t=>{var s,l;if(confirm(`Remove ${x.value.name} role from ${t.username}?`)){y.value=!0;try{await b.delete(`/admin/users/${t.id}/roles`,{data:{role:x.value.name}}),v.success(`Role removed from ${t.username}`),await P()}catch(r){v.error(((l=(s=r.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to remove role")}finally{y.value=!1}}};return(t,s)=>(a(),o("div",we,[e("div",ke,[e("div",Ce,[u(m(G),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),F(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>k.value=l),type:"text",placeholder:"Search roles...",class:"w-full pl-10 pr-4 py-3 bg-slate-800/50 border border-slate-700/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50 transition-all"},null,512),[[B,k.value]])]),e("button",{onClick:W,class:"inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white rounded-xl font-medium shadow-lg shadow-amber-500/20 transition-all"},[u(m(ge),{class:"w-5 h-5"}),s[4]||(s[4]=H(" Create Role ",-1))])]),V.value?(a(),o("div",Re,[...s[5]||(s[5]=[e("div",{class:"flex flex-col items-center justify-center"},[e("div",{class:"w-12 h-12 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mb-4"}),e("p",{class:"text-slate-400"},"Loading roles...")],-1)])])):$.value?(a(),o("div",$e,[e("div",je,[u(m(me),{class:"w-6 h-6 text-red-400"}),e("p",Ue,n($.value),1)])])):(a(),o("div",Se,[(a(!0),o(_,null,w(E.value,l=>{var r,i;return a(),o("div",{key:l.id,class:"group bg-slate-800/50 hover:bg-slate-800 backdrop-blur-sm rounded-2xl border border-slate-700/50 hover:border-slate-600/50 p-6 transition-all"},[e("div",Fe,[e("div",Te,[e("div",Ve,[u(m(I),{class:"w-5 h-5 text-white"})]),e("div",null,[e("h3",Me,n(l.name),1),e("p",Ne,"Created "+n(ae(l.created_at)),1)])]),e("div",De,[e("button",{onClick:p=>oe(l),class:"p-2 rounded-lg text-slate-400 hover:text-blue-400 hover:bg-blue-500/10 transition-colors",title:"Manage Users"},[u(m(be),{class:"w-4 h-4"})],8,Ae),e("button",{onClick:p=>X(l),class:"p-2 rounded-lg text-slate-400 hover:text-amber-400 hover:bg-slate-700/50 transition-colors"},[u(m(ye),{class:"w-4 h-4"})],8,Pe),e("button",{onClick:p=>se(l),class:"p-2 rounded-lg text-slate-400 hover:text-red-400 hover:bg-red-500/10 transition-colors"},[u(m(xe),{class:"w-4 h-4"})],8,Be)])]),e("div",Le,[e("div",qe,[s[6]||(s[6]=e("span",{class:"text-xs font-medium text-slate-400 uppercase tracking-wider"},"Permissions",-1)),e("span",ze,n(((r=l.permissions)==null?void 0:r.length)||0)+" total",1)]),(i=l.permissions)!=null&&i.length?(a(),o("div",Ee,[(a(!0),o(_,null,w(l.permissions.slice(0,6),p=>(a(),o("span",{key:p.id,class:"px-2 py-1 text-xs font-medium rounded-md bg-slate-700/50 text-slate-300"},n(p.name),1))),128)),l.permissions.length>6?(a(),o("span",Ge," +"+n(l.permissions.length-6)+" more ",1)):R("",!0)])):(a(),o("p",He,"No permissions assigned"))])])}),128)),E.value.length===0?(a(),o("div",Ie,[e("div",Qe,[u(m(I),{class:"w-8 h-8 text-slate-500"})]),s[7]||(s[7]=e("h3",{class:"text-lg font-medium text-white mb-2"},"No roles found",-1)),e("p",Ye,n(k.value?"Try adjusting your search query":"Create your first role to get started"),1)])):R("",!0)])),(a(),ve(pe,{to:"body"},[u(Y,{name:"modal"},{default:Q(()=>[j.value?(a(),o("div",Ze,[e("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:S}),e("div",Je,[e("div",Ke,[e("h2",Oe,n(h.value?"Edit Role":"Create Role"),1),e("button",{onClick:S,class:"p-2 rounded-lg text-slate-400 hover:text-white hover:bg-slate-700 transition-colors"},[u(m(J),{class:"w-5 h-5"})])]),e("div",We,[e("div",Xe,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium text-slate-300"},"Role Name",-1)),F(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>d.value.name=l),type:"text",placeholder:"e.g., moderator, support",class:"w-full px-4 py-3 bg-slate-900/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50 transition-all"},null,512),[[B,d.value.name]])]),e("div",es,[e("div",ss,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium text-slate-300"},"Permissions",-1)),e("span",ts,n(d.value.permissions.length)+" selected",1)]),q.value?(a(),o("div",ls,[...s[10]||(s[10]=[e("div",{class:"w-8 h-8 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin"},null,-1)])])):(a(),o("div",as,[(a(!0),o(_,null,w(K.value,(l,r)=>(a(),o("div",{key:r,class:"space-y-2"},[e("div",os,[e("h4",rs,n(r),1),e("button",{onClick:i=>te(r,l),type:"button",class:"text-xs text-slate-400 hover:text-white transition-colors"},n(le(r,l)?"Deselect All":"Select All"),9,ns)]),e("div",is,[(a(!0),o(_,null,w(l,i=>(a(),o("label",{key:i.id,class:"flex items-center gap-3 p-3 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 cursor-pointer transition-colors"},[F(e("input",{type:"checkbox",value:i.name,"onUpdate:modelValue":s[2]||(s[2]=p=>d.value.permissions=p),class:"w-4 h-4 rounded border-slate-600 text-amber-500 focus:ring-amber-500 focus:ring-offset-0 bg-slate-700"},null,8,ds),[[fe,d.value.permissions]]),e("span",cs,n(i.name),1)]))),128))])]))),128))]))])]),e("div",us,[e("button",{onClick:S,class:"px-4 py-2.5 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-xl font-medium transition-colors"}," Cancel "),e("button",{onClick:ee,disabled:U.value,class:"px-4 py-2.5 bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white rounded-xl font-medium shadow-lg shadow-amber-500/20 transition-all disabled:opacity-50"},n(U.value?"Saving...":h.value?"Save Changes":"Create Role"),9,ms)])])])):R("",!0)]),_:1}),u(Y,{name:"modal"},{default:Q(()=>{var l;return[M.value?(a(),o("div",vs,[e("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:A}),e("div",ps,[e("div",bs,[e("div",null,[e("h2",xs,"Manage Users - "+n((l=x.value)==null?void 0:l.name),1),s[11]||(s[11]=e("p",{class:"text-sm text-slate-400 mt-1"},"Assign or remove this role from users",-1))]),e("button",{onClick:A,class:"p-2 rounded-lg text-slate-400 hover:text-white hover:bg-slate-700 transition-colors"},[u(m(J),{class:"w-5 h-5"})])]),e("div",fs,[e("div",hs,[u(m(G),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),F(e("input",{"onUpdate:modelValue":s[3]||(s[3]=r=>f.value=r),onInput:re,type:"text",placeholder:"Search by username or email...",class:"w-full pl-10 pr-4 py-3 bg-slate-900/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500/50 transition-all"},null,544),[[B,f.value]])]),e("div",null,[s[13]||(s[13]=e("h3",{class:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3"},"Users with this role",-1)),N.value?(a(),o("div",gs,[...s[12]||(s[12]=[e("div",{class:"w-8 h-8 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin"},null,-1)])])):C.value.length?(a(),o("div",ys,[(a(!0),o(_,null,w(C.value,r=>{var i;return a(),o("div",{key:r.id,class:"flex items-center justify-between p-3 bg-slate-900/50 rounded-xl border border-slate-700/50"},[e("div",_s,[e("div",ws,n(((i=r.username)==null?void 0:i.charAt(0).toUpperCase())||"?"),1),e("div",null,[e("p",ks,n(r.username),1),e("p",Cs,n(r.email),1)])]),e("button",{onClick:p=>de(r),disabled:y.value,class:"px-3 py-1.5 bg-red-500/20 hover:bg-red-500/30 text-red-400 text-sm font-medium rounded-lg transition-colors disabled:opacity-50"}," Remove ",8,Rs)])}),128))])):(a(),o("p",$s,"No users have this role"))]),g.value.length?(a(),o("div",js,[s[15]||(s[15]=e("h3",{class:"text-sm font-medium text-slate-400 uppercase tracking-wider mb-3"},"Search Results",-1)),e("div",Us,[(a(!0),o(_,null,w(g.value,r=>{var i;return a(),o("div",{key:r.id,class:"flex items-center justify-between p-3 bg-slate-900/50 rounded-xl border border-slate-700/50"},[e("div",Ss,[e("div",Fs,n(((i=r.username)==null?void 0:i.charAt(0).toUpperCase())||"?"),1),e("div",null,[e("p",Ts,n(r.username),1),e("p",Vs,n(r.email),1)])]),ne(r)?(a(),o("span",Ns,[u(m(_e),{class:"w-4 h-4"}),s[14]||(s[14]=H(" Assigned ",-1))])):(a(),o("button",{key:0,onClick:p=>ie(r),disabled:y.value,class:"px-3 py-1.5 bg-amber-500 hover:bg-amber-600 text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50"}," Assign ",8,Ms))])}),128))])])):R("",!0)]),e("div",{class:"flex items-center justify-end gap-3 p-6 border-t border-slate-700 bg-slate-800/50 shrink-0"},[e("button",{onClick:A,class:"px-4 py-2.5 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-xl font-medium transition-colors"}," Close ")])])])):R("",!0)]}),_:1})]))]))}},zs=ce(Ds,[["__scopeId","data-v-b3526cb6"]]);export{zs as default};
