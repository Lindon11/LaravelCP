import{_ as O,e as P,h as r,a as e,n as v,t as i,k as g,v as j,m as h,s as m,l as _,F as z,i as W,x as V,g as c,q,y as E,u as I,o as d,d as w}from"./index-BJoLCnnK.js";const J={class:"tickets-page"},R={class:"page-header"},G={class:"header-stats"},K={class:"stat-value"},Q={class:"stat-value"},X={class:"stat-value"},Y={class:"filters-section"},Z={class:"search-wrapper"},tt={class:"filter-pills"},et={class:"tickets-container"},st={key:0,class:"loading-state"},at={key:1,class:"empty-state"},ot={key:2,class:"tickets-list"},nt=["onClick"],it={class:"ticket-main"},lt={class:"ticket-header"},rt={class:"ticket-id"},dt={class:"ticket-subject"},ut={class:"ticket-meta"},vt={class:"meta-item user"},ct={class:"meta-item"},pt={key:0,class:"meta-item messages"},gt={class:"ticket-status"},kt={key:0,class:"ticket-assignee"},ft={class:"avatar"},yt={key:1,class:"ticket-assignee unassigned"},ht={key:3,class:"pagination"},mt=["disabled"],_t={class:"page-info"},wt=["disabled"],xt={__name:"TicketListView",setup(Ct){const T=I(),B=E(),k=c(!0),f=c([]),U=c(null),p=c({open:0,waiting:0,urgent:0}),l=c({current_page:1,last_page:1,per_page:20,total:0}),o=c({search:"",status:"",priority:"",category:"",assigned:""});let y=null;const $=q(()=>o.value.search||o.value.status||o.value.priority||o.value.assigned),u=async(a=1)=>{k.value=!0;try{const t={page:a,per_page:l.value.per_page,...o.value};Object.keys(t).forEach(n=>{t[n]===""&&delete t[n]});const s=await V.get("/admin/support/tickets",{params:t});f.value=s.data.tickets||s.data.data||[],s.data.pagination&&(l.value=s.data.pagination),s.data.stats&&(p.value=s.data.stats)}catch(t){console.error("Failed to fetch tickets:",t),B.error("Failed to load tickets")}finally{k.value=!1}},S=async()=>{try{const a=await V.get("/user");U.value=a.data}catch(a){console.error("Failed to fetch current user:",a)}},F=()=>{y&&clearTimeout(y),y=setTimeout(()=>u(1),300)},x=a=>{a>=1&&a<=l.value.last_page&&u(a)},A=a=>{T.push(`/tickets/${a}`)},C=a=>{o.value.status=o.value.status===a?"":a,o.value.priority="",u(1)},D=a=>{o.value.priority=o.value.priority===a?"":a,o.value.status="",u(1)},L=()=>{o.value={search:"",status:"",priority:"",category:"",assigned:""},u(1)},N=a=>({open:"Open",waiting_response:"Waiting",answered:"Answered",closed:"Closed"})[a]||a,H=a=>{if(!a)return"";const t=new Date(a),n=new Date-t;return n<6e4?"Just now":n<36e5?`${Math.floor(n/6e4)}m ago`:n<864e5?`${Math.floor(n/36e5)}h ago`:n<6048e5?`${Math.floor(n/864e5)}d ago`:t.toLocaleDateString()};return P(()=>{u(),S()}),(a,t)=>(d(),r("div",J,[e("div",R,[t[12]||(t[12]=e("div",{class:"header-content"},[e("h1",null,"Support Tickets"),e("p",{class:"subtitle"},"Manage customer support requests")],-1)),e("div",G,[e("div",{class:v(["stat-card",{active:o.value.status==="open"}]),onClick:t[0]||(t[0]=s=>C("open"))},[e("span",K,i(p.value.open),1),t[9]||(t[9]=e("span",{class:"stat-label"},"Open",-1))],2),e("div",{class:v(["stat-card warning",{active:o.value.status==="waiting_response"}]),onClick:t[1]||(t[1]=s=>C("waiting_response"))},[e("span",Q,i(p.value.waiting),1),t[10]||(t[10]=e("span",{class:"stat-label"},"Waiting",-1))],2),e("div",{class:v(["stat-card danger",{active:o.value.priority==="urgent"}]),onClick:t[2]||(t[2]=s=>D("urgent"))},[e("span",X,i(p.value.urgent),1),t[11]||(t[11]=e("span",{class:"stat-label"},"Urgent",-1))],2)])]),e("div",Y,[e("div",Z,[t[13]||(t[13]=e("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"m21 21-4.35-4.35"})],-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.search=s),type:"text",placeholder:"Search tickets...",onInput:F},null,544),[[j,o.value.search]])]),e("div",tt,[g(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.status=s),onChange:u,class:"filter-select"},[...t[14]||(t[14]=[m('<option value="" data-v-d402a65a>All Status</option><option value="open" data-v-d402a65a>Open</option><option value="waiting_response" data-v-d402a65a>Waiting</option><option value="answered" data-v-d402a65a>Answered</option><option value="closed" data-v-d402a65a>Closed</option>',5)])],544),[[h,o.value.status]]),g(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.priority=s),onChange:u,class:"filter-select"},[...t[15]||(t[15]=[m('<option value="" data-v-d402a65a>All Priority</option><option value="urgent" data-v-d402a65a>Urgent</option><option value="high" data-v-d402a65a>High</option><option value="medium" data-v-d402a65a>Medium</option><option value="low" data-v-d402a65a>Low</option>',5)])],544),[[h,o.value.priority]]),g(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.value.assigned=s),onChange:u,class:"filter-select"},[...t[16]||(t[16]=[e("option",{value:""},"All",-1),e("option",{value:"unassigned"},"Unassigned",-1),e("option",{value:"me"},"My Tickets",-1)])],544),[[h,o.value.assigned]]),$.value?(d(),r("button",{key:0,class:"clear-btn",onClick:L}," Clear filters ")):_("",!0)])]),e("div",et,[k.value?(d(),r("div",st,[...t[17]||(t[17]=[e("div",{class:"spinner"},null,-1),e("span",null,"Loading tickets...",-1)])])):f.value.length===0?(d(),r("div",at,[...t[18]||(t[18]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("h3",null,"No tickets found",-1),e("p",null,"No tickets match your filters",-1)])])):(d(),r("div",ot,[(d(!0),r(z,null,W(f.value,s=>{var n,b,M;return d(),r("div",{key:s.id,class:v(["ticket-card",[`priority-${s.priority}`,{closed:s.status==="closed"}]]),onClick:bt=>A(s.id)},[e("div",{class:v(["ticket-priority",s.priority])},null,2),e("div",it,[e("div",lt,[e("span",rt,"#"+i(s.id),1),e("span",dt,i(s.subject),1)]),e("div",ut,[e("span",vt,[t[19]||(t[19]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1)),w(" "+i(((n=s.user)==null?void 0:n.username)||"Unknown"),1)]),e("span",ct,[t[20]||(t[20]=m('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-d402a65a><rect x="3" y="4" width="18" height="18" rx="2" ry="2" data-v-d402a65a></rect><line x1="16" y1="2" x2="16" y2="6" data-v-d402a65a></line><line x1="8" y1="2" x2="8" y2="6" data-v-d402a65a></line><line x1="3" y1="10" x2="21" y2="10" data-v-d402a65a></line></svg>',1)),w(" "+i(H(s.updated_at)),1)]),s.messages_count?(d(),r("span",pt,[t[21]||(t[21]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})],-1)),w(" "+i(s.messages_count),1)])):_("",!0)])]),e("div",gt,[e("span",{class:v(["status-badge",s.status])},i(N(s.status)),3),s.assigned_user?(d(),r("div",kt,[e("span",ft,i((M=(b=s.assigned_user.username)==null?void 0:b.charAt(0))==null?void 0:M.toUpperCase()),1)])):(d(),r("div",yt,[...t[22]||(t[22]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 8v4M12 16h.01"})],-1)])]))])],10,nt)}),128))])),l.value.last_page>1?(d(),r("div",ht,[e("button",{class:"page-btn",disabled:l.value.current_page===1,onClick:t[7]||(t[7]=s=>x(l.value.current_page-1))},[...t[23]||(t[23]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M15 18l-6-6 6-6"})],-1)])],8,mt),e("span",_t," Page "+i(l.value.current_page)+" of "+i(l.value.last_page),1),e("button",{class:"page-btn",disabled:l.value.current_page===l.value.last_page,onClick:t[8]||(t[8]=s=>x(l.value.current_page+1))},[...t[24]||(t[24]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 18l6-6-6-6"})],-1)])],8,wt)])):_("",!0)])]))}},Vt=O(xt,[["__scopeId","data-v-d402a65a"]]);export{Vt as default};
