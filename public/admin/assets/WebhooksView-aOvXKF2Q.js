import{o,h as a,a as e,e as te,x as v,b as c,z as r,d as T,W as C,t as i,aw as z,ax as q,H as se,k as _,v as $,F as W,i as D,j as le,n as x,l as m,g as u,q as oe,c as f,N as R,E as ae,Z as ne}from"./index-VJuD4EV8.js";import{r as re}from"./PlusIcon-CccdgNEK.js";import{r as H}from"./CheckCircleIcon-BfWao72n.js";import{r as Z}from"./ClockIcon-BYaJoGlX.js";import{r as ie}from"./PencilIcon-CrG3wviI.js";function de(L,p){return o(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 5.25v13.5m-7.5-13.5v13.5"})])}function ce(L,p){return o(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}const ue={class:"space-y-6"},ve={class:"flex items-center justify-end"},xe={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},pe={class:"rounded-2xl bg-slate-800/50 backdrop-blur border border-slate-700/50 p-4"},be={class:"flex items-center gap-3"},ge={class:"p-2 rounded-lg bg-violet-500/20"},me={class:"text-2xl font-bold text-white"},_e={class:"rounded-2xl bg-slate-800/50 backdrop-blur border border-slate-700/50 p-4"},fe={class:"flex items-center gap-3"},he={class:"p-2 rounded-lg bg-green-500/20"},ye={class:"text-2xl font-bold text-white"},we={class:"rounded-2xl bg-slate-800/50 backdrop-blur border border-slate-700/50 p-4"},ke={class:"flex items-center gap-3"},Ce={class:"p-2 rounded-lg bg-blue-500/20"},$e={class:"text-2xl font-bold text-white"},We={class:"rounded-2xl bg-slate-800/50 backdrop-blur border border-slate-700/50 p-4"},De={class:"flex items-center gap-3"},Fe={class:"p-2 rounded-lg bg-red-500/20"},Ve={class:"text-2xl font-bold text-white"},je={class:"rounded-2xl bg-slate-800/50 backdrop-blur border border-slate-700/50 overflow-hidden"},Me={class:"p-4 border-b border-slate-700/50"},Ne={class:"flex items-center gap-4"},Ee={class:"relative flex-1 max-w-md"},Te={key:0,class:"p-8 text-center"},Le={key:1,class:"p-8 text-center"},Ue={key:2,class:"divide-y divide-slate-700/50"},Be={class:"flex items-center justify-between"},Se={class:"flex items-center gap-4"},Ae={class:"font-medium text-white"},ze={class:"text-sm text-slate-400 truncate max-w-md"},qe={class:"flex items-center gap-2 mt-1"},Re={key:0,class:"text-xs text-slate-400"},He={class:"flex items-center gap-2"},Ze=["onClick"],Ie=["onClick"],Pe=["onClick"],Ge=["onClick"],Je=["onClick"],Ke={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Oe={class:"relative w-full max-w-2xl rounded-2xl bg-slate-800 border border-slate-700/50 p-6 shadow-xl"},Qe={class:"text-xl font-semibold text-white mb-4 flex items-center gap-3"},Xe={class:"grid grid-cols-2 gap-4"},Ye={class:"space-y-2"},et={class:"space-y-2"},tt={class:"space-y-2"},st={class:"space-y-2"},lt={class:"max-h-48 overflow-y-auto bg-slate-900/50 border border-slate-600/50 rounded-xl p-3 space-y-2"},ot={class:"flex items-center gap-2 cursor-pointer"},at=["checked"],nt={class:"grid grid-cols-2 gap-2"},rt=["value","disabled"],it={class:"text-sm text-slate-300"},dt={class:"space-y-2"},ct={class:"flex items-center justify-between"},ut={class:"flex justify-end gap-3 pt-4"},vt=["disabled"],xt={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},pt={class:"relative w-full max-w-4xl rounded-2xl bg-slate-800 border border-slate-700/50 p-6 shadow-xl"},bt={class:"text-xl font-semibold text-white mb-4 flex items-center gap-3"},gt={key:0,class:"p-8 text-center"},mt={key:1,class:"p-8 text-center text-slate-400"},_t={key:2,class:"max-h-96 overflow-y-auto space-y-2"},ft={class:"flex items-center justify-between"},ht={class:"flex items-center gap-3"},yt={class:"text-sm font-medium text-white"},wt={class:"text-xs text-slate-400"},kt={class:"flex items-center gap-2"},Ct={class:"text-xs text-slate-400"},$t=["onClick"],Wt={key:0,class:"mt-2 p-2 bg-red-500/10 rounded text-xs text-red-300"},Dt={class:"flex justify-end mt-4"},Et={__name:"WebhooksView",setup(L){const p=u([]),F=u(!0),h=u(!1),y=u(""),w=u(!1),k=u(!1),b=u(null),V=u([]),j=u(!1),M=u(null),U=u([]),g=u({total:0,active:0,deliveries_today:0,failed_today:0}),n=u({name:"",url:"",events:[],is_active:!0,retry_count:3}),B=oe(()=>{if(!y.value)return p.value;const l=y.value.toLowerCase();return p.value.filter(t=>t.name.toLowerCase().includes(l)||t.url.toLowerCase().includes(l))});te(async()=>{await Promise.all([N(),I()])});async function N(){F.value=!0;try{const l=await v.get("/admin/webhooks");p.value=l.data.data||l.data,S()}catch(l){console.error("Failed to load webhooks:",l)}finally{F.value=!1}}async function I(){try{const l=await v.get("/admin/webhooks/events");U.value=l.data.events}catch(l){console.error("Failed to load events:",l)}}function S(){g.value.total=p.value.length,g.value.active=p.value.filter(l=>l.is_active).length}function P(){b.value=null,n.value={name:"",url:"",events:[],is_active:!0,retry_count:3},w.value=!0}function G(l){b.value=l,n.value={name:l.name,url:l.url,events:[...l.events],is_active:l.is_active,retry_count:l.retry_count},w.value=!0}function E(){w.value=!1,b.value=null}async function J(){var l,t;h.value=!0;try{b.value?await v.patch(`/admin/webhooks/${b.value.id}`,n.value):await v.post("/admin/webhooks",n.value),await N(),E()}catch(s){console.error("Failed to save webhook:",s),alert(((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to save webhook")}finally{h.value=!1}}async function K(l){l.toggling=!0;try{await v.post(`/admin/webhooks/${l.id}/toggle`),l.is_active=!l.is_active,S()}catch(t){console.error("Failed to toggle webhook:",t)}finally{l.toggling=!1}}async function O(l){var t,s;try{const d=await v.post(`/admin/webhooks/${l.id}/test`);alert(d.data.message)}catch(d){alert("Test failed: "+(((s=(t=d.response)==null?void 0:t.data)==null?void 0:s.message)||d.message))}}async function A(l){M.value=l,k.value=!0,j.value=!0;try{const t=await v.get(`/admin/webhooks/${l.id}/deliveries`);V.value=t.data.data||t.data}catch(t){console.error("Failed to load deliveries:",t)}finally{j.value=!1}}async function Q(l){try{await v.post(`/admin/webhooks/${M.value.id}/deliveries/${l.id}/retry`),await A(M.value)}catch(t){console.error("Failed to retry delivery:",t)}}async function X(l){if(confirm(`Delete webhook "${l.name}"?`))try{await v.delete(`/admin/webhooks/${l.id}`),await N()}catch(t){console.error("Failed to delete webhook:",t)}}function Y(){n.value.events.includes("*")?n.value.events=[]:n.value.events=["*"]}function ee(l){return new Date(l).toLocaleString()}return(l,t)=>(o(),a("div",ue,[e("div",ve,[e("button",{onClick:P,class:"px-4 py-2 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-xl font-medium hover:from-violet-600 hover:to-purple-700 transition-all shadow-lg shadow-violet-500/25 flex items-center gap-2"},[c(r(re),{class:"w-5 h-5"}),t[8]||(t[8]=T(" Create Webhook ",-1))])]),e("div",xe,[e("div",pe,[e("div",be,[e("div",ge,[c(r(C),{class:"w-5 h-5 text-violet-400"})]),e("div",null,[e("p",me,i(g.value.total),1),t[9]||(t[9]=e("p",{class:"text-xs text-slate-400"},"Total Webhooks",-1))])])]),e("div",_e,[e("div",fe,[e("div",he,[c(r(H),{class:"w-5 h-5 text-green-400"})]),e("div",null,[e("p",ye,i(g.value.active),1),t[10]||(t[10]=e("p",{class:"text-xs text-slate-400"},"Active",-1))])])]),e("div",we,[e("div",ke,[e("div",Ce,[c(r(z),{class:"w-5 h-5 text-blue-400"})]),e("div",null,[e("p",$e,i(g.value.deliveries_today),1),t[11]||(t[11]=e("p",{class:"text-xs text-slate-400"},"Deliveries Today",-1))])])]),e("div",We,[e("div",De,[e("div",Fe,[c(r(q),{class:"w-5 h-5 text-red-400"})]),e("div",null,[e("p",Ve,i(g.value.failed_today),1),t[12]||(t[12]=e("p",{class:"text-xs text-slate-400"},"Failed Today",-1))])])])]),e("div",je,[e("div",Me,[e("div",Ne,[e("div",Ee,[c(r(se),{class:"w-5 h-5 text-slate-400 absolute left-3 top-2.5"}),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),type:"text",placeholder:"Search webhooks...",class:"w-full pl-10 pr-4 py-2 bg-slate-900/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50"},null,512),[[$,y.value]])])])]),F.value?(o(),a("div",Te,[...t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500 mx-auto"},null,-1),e("p",{class:"text-slate-400 mt-2"},"Loading webhooks...",-1)])])):B.value.length===0?(o(),a("div",Le,[c(r(C),{class:"w-12 h-12 text-slate-600 mx-auto mb-3"}),t[14]||(t[14]=e("p",{class:"text-slate-400"},"No webhooks found",-1))])):(o(),a("div",Ue,[(o(!0),a(W,null,D(B.value,s=>(o(),a("div",{key:s.id,class:"p-4 hover:bg-slate-700/20 transition-colors"},[e("div",Be,[e("div",Se,[e("div",{class:x(["p-2 rounded-lg",s.is_active?"bg-green-500/20":"bg-slate-600/20"])},[c(r(C),{class:x(["w-5 h-5",s.is_active?"text-green-400":"text-slate-400"])},null,8,["class"])],2),e("div",null,[e("h3",Ae,i(s.name),1),e("p",ze,i(s.url),1),e("div",qe,[(o(!0),a(W,null,D(s.events.slice(0,3),d=>(o(),a("span",{key:d,class:"px-2 py-0.5 text-xs rounded-full bg-violet-500/20 text-violet-300"},i(d),1))),128)),s.events.length>3?(o(),a("span",Re," +"+i(s.events.length-3)+" more ",1)):m("",!0)])])]),e("div",He,[e("span",{class:x(["px-2 py-1 text-xs rounded-full",s.is_active?"bg-green-500/20 text-green-400":"bg-slate-600/20 text-slate-400"])},i(s.is_active?"Active":"Inactive"),3),s.last_response_code?(o(),a("span",{key:0,class:x(["px-2 py-1 text-xs rounded-full",s.last_response_code>=200&&s.last_response_code<300?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"])},i(s.last_response_code),3)):m("",!0),e("button",{onClick:d=>O(s),class:"p-2 text-slate-400 hover:text-blue-400 hover:bg-blue-500/10 rounded-lg transition-colors",title:"Test webhook"},[c(r(z),{class:"w-5 h-5"})],8,Ze),e("button",{onClick:d=>K(s),class:"p-2 text-slate-400 hover:text-amber-400 hover:bg-amber-500/10 rounded-lg transition-colors",title:"Toggle status"},[s.toggling?(o(),f(r(R),{key:0,class:"w-5 h-5 animate-spin"})):s.is_active?(o(),f(r(de),{key:2,class:"w-5 h-5"})):(o(),f(r(ce),{key:1,class:"w-5 h-5"}))],8,Ie),e("button",{onClick:d=>A(s),class:"p-2 text-slate-400 hover:text-violet-400 hover:bg-violet-500/10 rounded-lg transition-colors",title:"View deliveries"},[c(r(Z),{class:"w-5 h-5"})],8,Pe),e("button",{onClick:d=>G(s),class:"p-2 text-slate-400 hover:text-white hover:bg-slate-600/50 rounded-lg transition-colors"},[c(r(ie),{class:"w-5 h-5"})],8,Ge),e("button",{onClick:d=>X(s),class:"p-2 text-slate-400 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors"},[c(r(ae),{class:"w-5 h-5"})],8,Je)])])]))),128))]))]),w.value?(o(),a("div",Ke,[e("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:E}),e("div",Oe,[e("h3",Qe,[c(r(C),{class:"w-6 h-6 text-violet-400"}),T(" "+i(b.value?"Edit Webhook":"Create Webhook"),1)]),e("form",{onSubmit:le(J,["prevent"]),class:"space-y-4"},[e("div",Xe,[e("div",Ye,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-slate-300"},"Name",-1)),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.name=s),type:"text",required:"",placeholder:"Discord Notifications",class:"w-full px-4 py-2 bg-slate-900/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50"},null,512),[[$,n.value.name]])]),e("div",et,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-slate-300"},"Retry Count",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.retry_count=s),type:"number",min:"0",max:"10",class:"w-full px-4 py-2 bg-slate-900/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50"},null,512),[[$,n.value.retry_count,void 0,{number:!0}]])])]),e("div",tt,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-slate-300"},"Webhook URL",-1)),_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.url=s),type:"url",required:"",placeholder:"https://discord.com/api/webhooks/...",class:"w-full px-4 py-2 bg-slate-900/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50"},null,512),[[$,n.value.url]])]),e("div",st,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-slate-300"},"Events",-1)),e("div",lt,[e("label",ot,[e("input",{type:"checkbox",checked:n.value.events.includes("*"),onChange:Y,class:"rounded border-slate-600 bg-slate-800 text-violet-500 focus:ring-violet-500"},null,40,at),t[18]||(t[18]=e("span",{class:"text-sm text-white font-medium"},"All Events (*)",-1))]),t[19]||(t[19]=e("div",{class:"border-t border-slate-700/50 my-2"},null,-1)),e("div",nt,[(o(!0),a(W,null,D(U.value,s=>(o(),a("label",{key:s,class:"flex items-center gap-2 cursor-pointer"},[_(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[4]||(t[4]=d=>n.value.events=d),disabled:n.value.events.includes("*"),class:"rounded border-slate-600 bg-slate-800 text-violet-500 focus:ring-violet-500"},null,8,rt),[[ne,n.value.events]]),e("span",it,i(s),1)]))),128))])])]),e("div",dt,[e("label",ct,[t[21]||(t[21]=e("span",{class:"text-sm font-medium text-slate-300"},"Active",-1)),e("button",{type:"button",onClick:t[5]||(t[5]=s=>n.value.is_active=!n.value.is_active),class:x(["relative inline-flex h-6 w-11 items-center rounded-full transition-colors",n.value.is_active?"bg-violet-500":"bg-slate-600"])},[e("span",{class:x(["inline-block h-4 w-4 transform rounded-full bg-white transition-transform",n.value.is_active?"translate-x-6":"translate-x-1"])},null,2)],2)])]),e("div",ut,[e("button",{type:"button",onClick:E,class:"px-4 py-2 text-slate-300 hover:text-white transition-colors"}," Cancel "),e("button",{type:"submit",disabled:h.value,class:"px-4 py-2 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-xl font-medium hover:from-violet-600 hover:to-purple-700 transition-all disabled:opacity-50"},i(h.value?"Saving...":b.value?"Update":"Create"),9,vt)])],32)])])):m("",!0),k.value?(o(),a("div",xt,[e("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:t[6]||(t[6]=s=>k.value=!1)}),e("div",pt,[e("h3",bt,[c(r(Z),{class:"w-6 h-6 text-violet-400"}),t[22]||(t[22]=T(" Delivery History ",-1))]),j.value?(o(),a("div",gt,[...t[23]||(t[23]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500 mx-auto"},null,-1)])])):V.value.length===0?(o(),a("div",mt," No deliveries yet ")):(o(),a("div",_t,[(o(!0),a(W,null,D(V.value,s=>(o(),a("div",{key:s.id,class:"p-3 bg-slate-900/50 rounded-xl"},[e("div",ft,[e("div",ht,[e("div",{class:x(["p-1.5 rounded-lg",s.response_code>=200&&s.response_code<300?"bg-green-500/20":"bg-red-500/20"])},[s.response_code>=200&&s.response_code<300?(o(),f(r(H),{key:0,class:"w-4 h-4 text-green-400"})):(o(),f(r(q),{key:1,class:"w-4 h-4 text-red-400"}))],2),e("div",null,[e("p",yt,i(s.event),1),e("p",wt,i(ee(s.created_at)),1)])]),e("div",kt,[e("span",Ct,i(s.response_time_ms)+"ms",1),e("span",{class:x(["px-2 py-0.5 text-xs rounded-full",s.response_code>=200&&s.response_code<300?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"])},i(s.response_code||"Failed"),3),s.response_code<200||s.response_code>=300?(o(),a("button",{key:0,onClick:d=>Q(s),class:"p-1 text-slate-400 hover:text-violet-400 transition-colors",title:"Retry"},[c(r(R),{class:"w-4 h-4"})],8,$t)):m("",!0)])]),s.error?(o(),a("div",Wt,i(s.error),1)):m("",!0)]))),128))])),e("div",Dt,[e("button",{onClick:t[7]||(t[7]=s=>k.value=!1),class:"px-4 py-2 text-slate-300 hover:text-white transition-colors"}," Close ")])])])):m("",!0)]))}};export{Et as default};
