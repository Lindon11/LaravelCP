import{o,h as a,a as e,e as te,x as v,b as d,z as r,W as f,d as $,t as i,aq as q,ar as z,H as se,k as _,v as W,F as D,i as F,j as le,n as x,l as m,g as u,q as oe,c as h,N as R,E as ae,Z as ne}from"./index-C4-NtIVR.js";import{r as re}from"./PlusIcon-Cj75NYe9.js";import{r as H}from"./CheckCircleIcon-CfnnMEHN.js";import{r as Z}from"./ClockIcon-B7y28HtQ.js";import{r as ie}from"./PencilIcon-BgmrvLlQ.js";function de(L,p){return o(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 5.25v13.5m-7.5-13.5v13.5"})])}function ce(L,p){return o(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})])}const ue={class:"space-y-6"},ve={class:"flex items-center justify-between"},xe={class:"text-2xl font-bold text-white flex items-center gap-3"},pe={class:"p-3 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600"},be={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ge={class:"rounded-2xl bg-slate-800/50 backdrop-blur border border-slate-700/50 p-4"},me={class:"flex items-center gap-3"},fe={class:"p-2 rounded-lg bg-violet-500/20"},_e={class:"text-2xl font-bold text-white"},he={class:"rounded-2xl bg-slate-800/50 backdrop-blur border border-slate-700/50 p-4"},we={class:"flex items-center gap-3"},ye={class:"p-2 rounded-lg bg-green-500/20"},ke={class:"text-2xl font-bold text-white"},Ce={class:"rounded-2xl bg-slate-800/50 backdrop-blur border border-slate-700/50 p-4"},$e={class:"flex items-center gap-3"},We={class:"p-2 rounded-lg bg-blue-500/20"},De={class:"text-2xl font-bold text-white"},Fe={class:"rounded-2xl bg-slate-800/50 backdrop-blur border border-slate-700/50 p-4"},Ve={class:"flex items-center gap-3"},je={class:"p-2 rounded-lg bg-red-500/20"},Me={class:"text-2xl font-bold text-white"},Ne={class:"rounded-2xl bg-slate-800/50 backdrop-blur border border-slate-700/50 overflow-hidden"},Ee={class:"p-4 border-b border-slate-700/50"},Te={class:"flex items-center gap-4"},Le={class:"relative flex-1 max-w-md"},Se={key:0,class:"p-8 text-center"},Ue={key:1,class:"p-8 text-center"},Be={key:2,class:"divide-y divide-slate-700/50"},Ae={class:"flex items-center justify-between"},qe={class:"flex items-center gap-4"},ze={class:"font-medium text-white"},Re={class:"text-sm text-slate-400 truncate max-w-md"},He={class:"flex items-center gap-2 mt-1"},Ze={key:0,class:"text-xs text-slate-400"},Ie={class:"flex items-center gap-2"},Pe=["onClick"],Ge=["onClick"],Je=["onClick"],Ke=["onClick"],Oe=["onClick"],Qe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Xe={class:"relative w-full max-w-2xl rounded-2xl bg-slate-800 border border-slate-700/50 p-6 shadow-xl"},Ye={class:"text-xl font-semibold text-white mb-4 flex items-center gap-3"},et={class:"grid grid-cols-2 gap-4"},tt={class:"space-y-2"},st={class:"space-y-2"},lt={class:"space-y-2"},ot={class:"space-y-2"},at={class:"max-h-48 overflow-y-auto bg-slate-900/50 border border-slate-600/50 rounded-xl p-3 space-y-2"},nt={class:"flex items-center gap-2 cursor-pointer"},rt=["checked"],it={class:"grid grid-cols-2 gap-2"},dt=["value","disabled"],ct={class:"text-sm text-slate-300"},ut={class:"space-y-2"},vt={class:"flex items-center justify-between"},xt={class:"flex justify-end gap-3 pt-4"},pt=["disabled"],bt={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},gt={class:"relative w-full max-w-4xl rounded-2xl bg-slate-800 border border-slate-700/50 p-6 shadow-xl"},mt={class:"text-xl font-semibold text-white mb-4 flex items-center gap-3"},ft={key:0,class:"p-8 text-center"},_t={key:1,class:"p-8 text-center text-slate-400"},ht={key:2,class:"max-h-96 overflow-y-auto space-y-2"},wt={class:"flex items-center justify-between"},yt={class:"flex items-center gap-3"},kt={class:"text-sm font-medium text-white"},Ct={class:"text-xs text-slate-400"},$t={class:"flex items-center gap-2"},Wt={class:"text-xs text-slate-400"},Dt=["onClick"],Ft={key:0,class:"mt-2 p-2 bg-red-500/10 rounded text-xs text-red-300"},Vt={class:"flex justify-end mt-4"},Lt={__name:"WebhooksView",setup(L){const p=u([]),V=u(!0),w=u(!1),y=u(""),k=u(!1),C=u(!1),b=u(null),j=u([]),M=u(!1),N=u(null),S=u([]),g=u({total:0,active:0,deliveries_today:0,failed_today:0}),n=u({name:"",url:"",events:[],is_active:!0,retry_count:3}),U=oe(()=>{if(!y.value)return p.value;const l=y.value.toLowerCase();return p.value.filter(t=>t.name.toLowerCase().includes(l)||t.url.toLowerCase().includes(l))});te(async()=>{await Promise.all([E(),I()])});async function E(){V.value=!0;try{const l=await v.get("/admin/webhooks");p.value=l.data.data||l.data,B()}catch(l){console.error("Failed to load webhooks:",l)}finally{V.value=!1}}async function I(){try{const l=await v.get("/admin/webhooks/events");S.value=l.data.events}catch(l){console.error("Failed to load events:",l)}}function B(){g.value.total=p.value.length,g.value.active=p.value.filter(l=>l.is_active).length}function P(){b.value=null,n.value={name:"",url:"",events:[],is_active:!0,retry_count:3},k.value=!0}function G(l){b.value=l,n.value={name:l.name,url:l.url,events:[...l.events],is_active:l.is_active,retry_count:l.retry_count},k.value=!0}function T(){k.value=!1,b.value=null}async function J(){var l,t;w.value=!0;try{b.value?await v.patch(`/admin/webhooks/${b.value.id}`,n.value):await v.post("/admin/webhooks",n.value),await E(),T()}catch(s){console.error("Failed to save webhook:",s),alert(((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to save webhook")}finally{w.value=!1}}async function K(l){l.toggling=!0;try{await v.post(`/admin/webhooks/${l.id}/toggle`),l.is_active=!l.is_active,B()}catch(t){console.error("Failed to toggle webhook:",t)}finally{l.toggling=!1}}async function O(l){var t,s;try{const c=await v.post(`/admin/webhooks/${l.id}/test`);alert(c.data.message)}catch(c){alert("Test failed: "+(((s=(t=c.response)==null?void 0:t.data)==null?void 0:s.message)||c.message))}}async function A(l){N.value=l,C.value=!0,M.value=!0;try{const t=await v.get(`/admin/webhooks/${l.id}/deliveries`);j.value=t.data.data||t.data}catch(t){console.error("Failed to load deliveries:",t)}finally{M.value=!1}}async function Q(l){try{await v.post(`/admin/webhooks/${N.value.id}/deliveries/${l.id}/retry`),await A(N.value)}catch(t){console.error("Failed to retry delivery:",t)}}async function X(l){if(confirm(`Delete webhook "${l.name}"?`))try{await v.delete(`/admin/webhooks/${l.id}`),await E()}catch(t){console.error("Failed to delete webhook:",t)}}function Y(){n.value.events.includes("*")?n.value.events=[]:n.value.events=["*"]}function ee(l){return new Date(l).toLocaleString()}return(l,t)=>(o(),a("div",ue,[e("div",ve,[e("div",null,[e("h1",xe,[e("div",pe,[d(r(f),{class:"w-6 h-6 text-white"})]),t[8]||(t[8]=$(" Webhooks ",-1))]),t[9]||(t[9]=e("p",{class:"text-sm text-slate-400 mt-1"},"Manage outgoing webhook integrations for Discord, Slack, and custom endpoints",-1))]),e("button",{onClick:P,class:"px-4 py-2 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-xl font-medium hover:from-violet-600 hover:to-purple-700 transition-all shadow-lg shadow-violet-500/25 flex items-center gap-2"},[d(r(re),{class:"w-5 h-5"}),t[10]||(t[10]=$(" Create Webhook ",-1))])]),e("div",be,[e("div",ge,[e("div",me,[e("div",fe,[d(r(f),{class:"w-5 h-5 text-violet-400"})]),e("div",null,[e("p",_e,i(g.value.total),1),t[11]||(t[11]=e("p",{class:"text-xs text-slate-400"},"Total Webhooks",-1))])])]),e("div",he,[e("div",we,[e("div",ye,[d(r(H),{class:"w-5 h-5 text-green-400"})]),e("div",null,[e("p",ke,i(g.value.active),1),t[12]||(t[12]=e("p",{class:"text-xs text-slate-400"},"Active",-1))])])]),e("div",Ce,[e("div",$e,[e("div",We,[d(r(q),{class:"w-5 h-5 text-blue-400"})]),e("div",null,[e("p",De,i(g.value.deliveries_today),1),t[13]||(t[13]=e("p",{class:"text-xs text-slate-400"},"Deliveries Today",-1))])])]),e("div",Fe,[e("div",Ve,[e("div",je,[d(r(z),{class:"w-5 h-5 text-red-400"})]),e("div",null,[e("p",Me,i(g.value.failed_today),1),t[14]||(t[14]=e("p",{class:"text-xs text-slate-400"},"Failed Today",-1))])])])]),e("div",Ne,[e("div",Ee,[e("div",Te,[e("div",Le,[d(r(se),{class:"w-5 h-5 text-slate-400 absolute left-3 top-2.5"}),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),type:"text",placeholder:"Search webhooks...",class:"w-full pl-10 pr-4 py-2 bg-slate-900/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50"},null,512),[[W,y.value]])])])]),V.value?(o(),a("div",Se,[...t[15]||(t[15]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500 mx-auto"},null,-1),e("p",{class:"text-slate-400 mt-2"},"Loading webhooks...",-1)])])):U.value.length===0?(o(),a("div",Ue,[d(r(f),{class:"w-12 h-12 text-slate-600 mx-auto mb-3"}),t[16]||(t[16]=e("p",{class:"text-slate-400"},"No webhooks found",-1))])):(o(),a("div",Be,[(o(!0),a(D,null,F(U.value,s=>(o(),a("div",{key:s.id,class:"p-4 hover:bg-slate-700/20 transition-colors"},[e("div",Ae,[e("div",qe,[e("div",{class:x(["p-2 rounded-lg",s.is_active?"bg-green-500/20":"bg-slate-600/20"])},[d(r(f),{class:x(["w-5 h-5",s.is_active?"text-green-400":"text-slate-400"])},null,8,["class"])],2),e("div",null,[e("h3",ze,i(s.name),1),e("p",Re,i(s.url),1),e("div",He,[(o(!0),a(D,null,F(s.events.slice(0,3),c=>(o(),a("span",{key:c,class:"px-2 py-0.5 text-xs rounded-full bg-violet-500/20 text-violet-300"},i(c),1))),128)),s.events.length>3?(o(),a("span",Ze," +"+i(s.events.length-3)+" more ",1)):m("",!0)])])]),e("div",Ie,[e("span",{class:x(["px-2 py-1 text-xs rounded-full",s.is_active?"bg-green-500/20 text-green-400":"bg-slate-600/20 text-slate-400"])},i(s.is_active?"Active":"Inactive"),3),s.last_response_code?(o(),a("span",{key:0,class:x(["px-2 py-1 text-xs rounded-full",s.last_response_code>=200&&s.last_response_code<300?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"])},i(s.last_response_code),3)):m("",!0),e("button",{onClick:c=>O(s),class:"p-2 text-slate-400 hover:text-blue-400 hover:bg-blue-500/10 rounded-lg transition-colors",title:"Test webhook"},[d(r(q),{class:"w-5 h-5"})],8,Pe),e("button",{onClick:c=>K(s),class:"p-2 text-slate-400 hover:text-amber-400 hover:bg-amber-500/10 rounded-lg transition-colors",title:"Toggle status"},[s.toggling?(o(),h(r(R),{key:0,class:"w-5 h-5 animate-spin"})):s.is_active?(o(),h(r(de),{key:2,class:"w-5 h-5"})):(o(),h(r(ce),{key:1,class:"w-5 h-5"}))],8,Ge),e("button",{onClick:c=>A(s),class:"p-2 text-slate-400 hover:text-violet-400 hover:bg-violet-500/10 rounded-lg transition-colors",title:"View deliveries"},[d(r(Z),{class:"w-5 h-5"})],8,Je),e("button",{onClick:c=>G(s),class:"p-2 text-slate-400 hover:text-white hover:bg-slate-600/50 rounded-lg transition-colors"},[d(r(ie),{class:"w-5 h-5"})],8,Ke),e("button",{onClick:c=>X(s),class:"p-2 text-slate-400 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors"},[d(r(ae),{class:"w-5 h-5"})],8,Oe)])])]))),128))]))]),k.value?(o(),a("div",Qe,[e("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:T}),e("div",Xe,[e("h3",Ye,[d(r(f),{class:"w-6 h-6 text-violet-400"}),$(" "+i(b.value?"Edit Webhook":"Create Webhook"),1)]),e("form",{onSubmit:le(J,["prevent"]),class:"space-y-4"},[e("div",et,[e("div",tt,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-slate-300"},"Name",-1)),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.name=s),type:"text",required:"",placeholder:"Discord Notifications",class:"w-full px-4 py-2 bg-slate-900/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50"},null,512),[[W,n.value.name]])]),e("div",st,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-slate-300"},"Retry Count",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.retry_count=s),type:"number",min:"0",max:"10",class:"w-full px-4 py-2 bg-slate-900/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50"},null,512),[[W,n.value.retry_count,void 0,{number:!0}]])])]),e("div",lt,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-slate-300"},"Webhook URL",-1)),_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.url=s),type:"url",required:"",placeholder:"https://discord.com/api/webhooks/...",class:"w-full px-4 py-2 bg-slate-900/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50"},null,512),[[W,n.value.url]])]),e("div",ot,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-slate-300"},"Events",-1)),e("div",at,[e("label",nt,[e("input",{type:"checkbox",checked:n.value.events.includes("*"),onChange:Y,class:"rounded border-slate-600 bg-slate-800 text-violet-500 focus:ring-violet-500"},null,40,rt),t[20]||(t[20]=e("span",{class:"text-sm text-white font-medium"},"All Events (*)",-1))]),t[21]||(t[21]=e("div",{class:"border-t border-slate-700/50 my-2"},null,-1)),e("div",it,[(o(!0),a(D,null,F(S.value,s=>(o(),a("label",{key:s,class:"flex items-center gap-2 cursor-pointer"},[_(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[4]||(t[4]=c=>n.value.events=c),disabled:n.value.events.includes("*"),class:"rounded border-slate-600 bg-slate-800 text-violet-500 focus:ring-violet-500"},null,8,dt),[[ne,n.value.events]]),e("span",ct,i(s),1)]))),128))])])]),e("div",ut,[e("label",vt,[t[23]||(t[23]=e("span",{class:"text-sm font-medium text-slate-300"},"Active",-1)),e("button",{type:"button",onClick:t[5]||(t[5]=s=>n.value.is_active=!n.value.is_active),class:x(["relative inline-flex h-6 w-11 items-center rounded-full transition-colors",n.value.is_active?"bg-violet-500":"bg-slate-600"])},[e("span",{class:x(["inline-block h-4 w-4 transform rounded-full bg-white transition-transform",n.value.is_active?"translate-x-6":"translate-x-1"])},null,2)],2)])]),e("div",xt,[e("button",{type:"button",onClick:T,class:"px-4 py-2 text-slate-300 hover:text-white transition-colors"}," Cancel "),e("button",{type:"submit",disabled:w.value,class:"px-4 py-2 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-xl font-medium hover:from-violet-600 hover:to-purple-700 transition-all disabled:opacity-50"},i(w.value?"Saving...":b.value?"Update":"Create"),9,pt)])],32)])])):m("",!0),C.value?(o(),a("div",bt,[e("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:t[6]||(t[6]=s=>C.value=!1)}),e("div",gt,[e("h3",mt,[d(r(Z),{class:"w-6 h-6 text-violet-400"}),t[24]||(t[24]=$(" Delivery History ",-1))]),M.value?(o(),a("div",ft,[...t[25]||(t[25]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500 mx-auto"},null,-1)])])):j.value.length===0?(o(),a("div",_t," No deliveries yet ")):(o(),a("div",ht,[(o(!0),a(D,null,F(j.value,s=>(o(),a("div",{key:s.id,class:"p-3 bg-slate-900/50 rounded-xl"},[e("div",wt,[e("div",yt,[e("div",{class:x(["p-1.5 rounded-lg",s.response_code>=200&&s.response_code<300?"bg-green-500/20":"bg-red-500/20"])},[s.response_code>=200&&s.response_code<300?(o(),h(r(H),{key:0,class:"w-4 h-4 text-green-400"})):(o(),h(r(z),{key:1,class:"w-4 h-4 text-red-400"}))],2),e("div",null,[e("p",kt,i(s.event),1),e("p",Ct,i(ee(s.created_at)),1)])]),e("div",$t,[e("span",Wt,i(s.response_time_ms)+"ms",1),e("span",{class:x(["px-2 py-0.5 text-xs rounded-full",s.response_code>=200&&s.response_code<300?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"])},i(s.response_code||"Failed"),3),s.response_code<200||s.response_code>=300?(o(),a("button",{key:0,onClick:c=>Q(s),class:"p-1 text-slate-400 hover:text-violet-400 transition-colors",title:"Retry"},[d(r(R),{class:"w-4 h-4"})],8,Dt)):m("",!0)])]),s.error?(o(),a("div",Ft,i(s.error),1)):m("",!0)]))),128))])),e("div",Vt,[e("button",{onClick:t[7]||(t[7]=s=>C.value=!1),class:"px-4 py-2 text-slate-300 hover:text-white transition-colors"}," Close ")])])])):m("",!0)]))}};export{Lt as default};
