import{_ as ae,G as oe,h as l,a as e,k as b,v as S,H as ne,F as p,i as m,l as u,t as n,d as ie,m as K,s as re,j as de,g as r,x as c,q as ue,o as a,n as L}from"./index-D3jdM4om.js";const ce={class:"user-tools"},ve={class:"view-header"},ye={class:"flex items-center justify-between"},pe={class:"search-box"},me={class:"relative"},he={key:0,class:"search-results"},_e=["onClick"],be={class:"font-medium"},ge={class:"text-slate-400 text-sm ml-2"},fe={class:"text-slate-500 text-xs ml-2"},ke={key:0,class:"empty-state"},xe={key:1,class:"user-view"},we={class:"user-header"},Ce={class:"user-info"},Te={class:"user-avatar"},Fe={class:"text-xl font-bold text-slate-100"},$e={class:"text-slate-500 text-sm font-normal"},Ue={class:"text-sm text-slate-400 mt-1"},Ne={class:"tabs"},Se=["onClick"],Le={class:"tab-content"},Ve={key:0,class:"tab-panel"},Ae={class:"panel-header"},Re={class:"text-sm text-slate-400"},je={key:0,class:"loading"},De={key:1,class:"data-table"},Ie={class:"badge"},Je={class:"codename"},qe={key:0,class:"text-green-400"},He={key:1,class:"text-slate-500"},Be={key:2,class:"empty"},Me={key:1,class:"tab-panel"},Ee={key:0,class:"loading"},Ge={key:1,class:"data-table"},ze={class:"codename"},Ke={class:"badge"},Qe={key:2,class:"empty"},Oe={key:2,class:"tab-panel"},We={class:"panel-header"},Ye={key:0,class:"loading"},Pe={key:1,class:"data-table"},Xe={class:"codename"},Ze={class:"badge"},et={key:0,class:"text-green-400"},tt={key:1,class:"text-red-400"},st={key:2,class:"text-slate-400"},lt={key:2,class:"empty"},at={key:3,class:"tab-panel"},ot={key:0,class:"loading"},nt={key:1,class:"data-table"},it=["onClick"],rt={key:2,class:"empty"},dt={key:4,class:"tab-panel"},ut={class:"panel-header"},ct={key:0,class:"loading"},vt={key:1,class:"flags-grid"},yt={class:"flag-header"},pt={class:"flag-label"},mt=["onClick"],ht={key:0,class:"flag-value"},_t={key:1,class:"flag-reason"},bt={key:2,class:"empty"},gt={class:"modal"},ft={class:"form-group"},kt={class:"form-group"},xt={class:"form-group"},wt={class:"form-group"},Ct={class:"modal-actions"},Tt={key:5,class:"tab-panel"},Ft={key:0,class:"loading"},$t={key:1,class:"data-table"},Ut={key:2,class:"empty"},Nt={__name:"UserToolsView",setup(St){const g=r(""),w=r([]),i=r(null),v=r("items"),Q=[{key:"items",label:"Items"},{key:"jobs",label:"Jobs"},{key:"history",label:"Job History"},{key:"timers",label:"Timers"},{key:"flags",label:"Flags"},{key:"activity",label:"Activity"}],h=r({}),C=r([]),T=r([]),F=r({timers:[],user_timers:[]}),$=r([]),U=r([]),V=r("all"),A=r(!1),R=r(!1),j=r(!1),D=r(!1),I=r(!1),J=r(!1),f=r(!1),y=r({type:"",label:"",reason:"",severity:"info"}),M=ue(()=>{const o=[...F.value.user_timers||[]];for(const s of F.value.timers||[])o.push({type:s.type,expires_at:s.expires_at});return o}),E=async()=>{if(g.value.trim())try{const o=await c.get("/admin/user-tools/search",{params:{q:g.value}});w.value=o.data.users||[]}catch(o){console.error("Search failed:",o)}},O=async o=>{var s,_;w.value=[],g.value="";try{console.log("Fetching user:",o.id);const d=await c.get(`/admin/user-tools/${o.id}`);console.log("User response:",d.data),i.value=d.data.user,console.log("Selected user set:",i.value),G()}catch(d){console.error("Failed to load user:",d),alert("Failed to load user: "+(((_=(s=d.response)==null?void 0:s.data)==null?void 0:_.message)||d.message))}},W=()=>{i.value=null,h.value={},C.value=[],T.value=[],F.value={timers:[],user_timers:[]},$.value=[],U.value=[]},G=()=>{if(i.value)switch(v.value){case"items":Y();break;case"jobs":P();break;case"history":z();break;case"timers":q();break;case"flags":H();break;case"activity":te();break}},Y=async()=>{A.value=!0;try{const o=await c.get(`/admin/user-tools/${i.value.id}/inventory`);h.value=o.data}catch(o){console.error("Failed to load inventory:",o)}finally{A.value=!1}},P=async()=>{R.value=!0;try{const o=await c.get(`/admin/user-tools/${i.value.id}/jobs`);C.value=o.data.jobs||[]}catch(o){console.error("Failed to load jobs:",o)}finally{R.value=!1}},z=async()=>{j.value=!0;try{const o=await c.get(`/admin/user-tools/${i.value.id}/job-history`,{params:{type:V.value}});T.value=o.data.history||[]}catch(o){console.error("Failed to load job history:",o)}finally{j.value=!1}},q=async()=>{D.value=!0;try{const o=await c.get(`/admin/user-tools/${i.value.id}/timers`);F.value=o.data}catch(o){console.error("Failed to load timers:",o)}finally{D.value=!1}},X=async o=>{if(confirm(`Clear ${o} timer?`))try{await c.delete(`/admin/user-tools/${i.value.id}/timers/${o}`),q()}catch{alert("Failed to clear timer")}},H=async()=>{I.value=!0;try{const o=await c.get(`/admin/user-tools/${i.value.id}/flags`);$.value=o.data.flags||[]}catch(o){console.error("Failed to load flags:",o)}finally{I.value=!1}},Z=async()=>{try{await c.post(`/admin/user-tools/${i.value.id}/flags`,y.value),f.value=!1,y.value={type:"",label:"",reason:"",severity:"info"},H()}catch{alert("Failed to add flag")}},ee=async o=>{if(confirm(`Remove ${o} flag?`))try{await c.delete(`/admin/user-tools/${i.value.id}/flags/${o}`),H()}catch{alert("Failed to remove flag")}},te=async()=>{J.value=!0;try{const o=await c.get(`/admin/user-tools/${i.value.id}/activity`);U.value=o.data.activity||[]}catch(o){console.error("Failed to load activity:",o)}finally{J.value=!1}},N=o=>o?new Date(o).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).replace(","," at"):"-",se=o=>{const s=new Date,d=new Date(o)-s;if(d<=0)return"Expired";const k=Math.floor(d/(1e3*60*60)),x=Math.floor(d%(1e3*60*60)/(1e3*60));return k>0?`${k}h ${x}m`:`${x}m`},le=o=>o.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase());return oe(v,G),(o,s)=>{var _,d,k,x;return a(),l("div",ce,[e("div",ve,[e("div",ye,[s[9]||(s[9]=e("div",null,[e("h1",{class:"text-2xl font-bold text-slate-100"},"User Tools"),e("p",{class:"text-slate-400 mt-1"},"Inspect and manage individual user data")],-1)),e("div",pe,[e("div",me,[b(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>g.value=t),type:"text",placeholder:"Search by username, email, or ID...",class:"search-input",onKeyup:ne(E,["enter"])},null,544),[[S,g.value]]),e("button",{onClick:E,class:"search-btn"}," ðŸ” Find User ")]),w.value.length>0?(a(),l("div",he,[(a(!0),l(p,null,m(w.value,t=>(a(),l("div",{key:t.id,class:"search-result-item",onClick:B=>O(t)},[e("span",be,n(t.username),1),e("span",ge,"#"+n(t.id),1),e("span",fe,"Lvl "+n(t.level),1)],8,_e))),128))])):u("",!0)])])]),i.value?(a(),l("div",xe,[e("div",we,[e("div",Ce,[e("div",Te,n(i.value.username.charAt(0).toUpperCase()),1),e("div",null,[e("h2",Fe,[ie(" User Tools: "+n(i.value.username)+" ",1),e("span",$e,"#"+n(i.value.id),1)]),e("div",Ue," Level "+n(i.value.level)+" Â· "+n(((_=i.value.currentRank)==null?void 0:_.name)||((d=i.value.current_rank)==null?void 0:d.name)||"No Rank")+" Â· "+n(((k=i.value.location)==null?void 0:k.name)||"Unknown Location"),1)])]),e("button",{onClick:W,class:"btn btn-secondary"}," âœ• Clear ")]),e("div",Ne,[(a(),l(p,null,m(Q,t=>e("button",{key:t.key,class:L(["tab",{active:v.value===t.key}]),onClick:B=>v.value=t.key},n(t.label),11,Se)),64))]),e("div",Le,[v.value==="items"?(a(),l("div",Ve,[e("div",Ae,[s[11]||(s[11]=e("h3",null,"Inventory Items",-1)),e("div",Re," Total: "+n(h.value.total_items||0)+" items Â· Value: $"+n((h.value.total_value||0).toLocaleString()),1)]),A.value?(a(),l("div",je,"Loading inventory...")):(x=h.value.inventory)!=null&&x.length?(a(),l("table",De,[s[12]||(s[12]=e("thead",null,[e("tr",null,[e("th",null,"Item Name"),e("th",null,"Type"),e("th",null,"Codename"),e("th",null,"Quantity"),e("th",null,"Value"),e("th",null,"Equipped")])],-1)),e("tbody",null,[(a(!0),l(p,null,m(h.value.inventory,t=>(a(),l("tr",{key:t.id},[e("td",null,n(t.item_name),1),e("td",null,[e("span",Ie,n(t.item_type),1)]),e("td",null,[e("code",Je,n(t.item_codename||"-"),1)]),e("td",null,n(t.quantity),1),e("td",null,"$"+n((t.item_value*t.quantity).toLocaleString()),1),e("td",null,[t.equipped?(a(),l("span",qe,"âœ“")):(a(),l("span",He,"-"))])]))),128))])])):(a(),l("div",Be,"No items in inventory"))])):u("",!0),v.value==="jobs"?(a(),l("div",Me,[s[14]||(s[14]=e("div",{class:"panel-header"},[e("h3",null,"Job Statistics")],-1)),R.value?(a(),l("div",Ee,"Loading jobs...")):C.value.length?(a(),l("table",Ge,[s[13]||(s[13]=e("thead",null,[e("tr",null,[e("th",null,"Job Name"),e("th",null,"Codename"),e("th",null,"Type"),e("th",null,"Total Completed")])],-1)),e("tbody",null,[(a(!0),l(p,null,m(C.value,t=>(a(),l("tr",{key:t.codename},[e("td",null,n(t.name),1),e("td",null,[e("code",ze,n(t.codename||"-"),1)]),e("td",null,[e("span",Ke,n(t.type),1)]),e("td",null,n(t.total_completed),1)]))),128))])])):(a(),l("div",Qe,"No job statistics found"))])):u("",!0),v.value==="history"?(a(),l("div",Oe,[e("div",We,[s[16]||(s[16]=e("h3",null,"Job History",-1)),b(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>V.value=t),onChange:z,class:"filter-select"},[...s[15]||(s[15]=[re('<option value="all" data-v-b4c15938>All Types</option><option value="crime_attempt" data-v-b4c15938>Crimes</option><option value="theft_attempt" data-v-b4c15938>Theft</option><option value="gym_train" data-v-b4c15938>Gym</option><option value="organized_crime" data-v-b4c15938>Organized Crime</option>',5)])],544),[[K,V.value]])]),j.value?(a(),l("div",Ye,"Loading history...")):T.value.length?(a(),l("table",Pe,[s[17]||(s[17]=e("thead",null,[e("tr",null,[e("th",null,"Job Name"),e("th",null,"Codename"),e("th",null,"Type"),e("th",null,"Result"),e("th",null,"Time")])],-1)),e("tbody",null,[(a(!0),l(p,null,m(T.value,t=>(a(),l("tr",{key:t.id},[e("td",null,n(t.name),1),e("td",null,[e("code",Xe,n(t.codename||"-"),1)]),e("td",null,[e("span",Ze,n(t.type),1)]),e("td",null,[t.success===!0?(a(),l("span",et,"Success")):t.success===!1?(a(),l("span",tt,"Failed")):(a(),l("span",st,"-"))]),e("td",null,n(N(t.time)),1)]))),128))])])):(a(),l("div",lt,"No job history found"))])):u("",!0),v.value==="timers"?(a(),l("div",at,[e("div",{class:"panel-header"},[s[18]||(s[18]=e("h3",null,"Active Timers & Cooldowns",-1)),e("button",{onClick:q,class:"btn btn-secondary btn-sm"},"ðŸ”„ Refresh")]),D.value?(a(),l("div",ot,"Loading timers...")):M.value.length?(a(),l("table",nt,[s[19]||(s[19]=e("thead",null,[e("tr",null,[e("th",null,"Timer Type"),e("th",null,"Expires At"),e("th",null,"Remaining"),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),l(p,null,m(M.value,t=>(a(),l("tr",{key:t.type},[e("td",null,[e("span",{class:L(["badge",t.type])},n(le(t.type)),3)]),e("td",null,n(N(t.expires_at)),1),e("td",null,n(se(t.expires_at)),1),e("td",null,[e("button",{onClick:B=>X(t.type),class:"btn btn-danger btn-sm"}," Clear ",8,it)])]))),128))])])):(a(),l("div",rt,"No active timers"))])):u("",!0),v.value==="flags"?(a(),l("div",dt,[e("div",ut,[s[20]||(s[20]=e("h3",null,"User Flags & Tags",-1)),e("button",{onClick:s[2]||(s[2]=t=>f.value=!0),class:"btn btn-primary btn-sm"},"+ Add Flag")]),I.value?(a(),l("div",ct,"Loading flags...")):$.value.length?(a(),l("div",vt,[(a(!0),l(p,null,m($.value,t=>(a(),l("div",{key:t.type,class:L(["flag-card",t.severity])},[e("div",yt,[e("span",pt,n(t.label),1),t.type!=="role"?(a(),l("button",{key:0,onClick:B=>ee(t.type),class:"flag-remove"},"Ã—",8,mt)):u("",!0)]),t.value&&t.value!==!0?(a(),l("div",ht,n(typeof t.value=="string"&&t.value.includes("T")?N(t.value):t.value),1)):u("",!0),t.reason?(a(),l("div",_t,n(t.reason),1)):u("",!0)],2))),128))])):(a(),l("div",bt,"No flags assigned")),f.value?(a(),l("div",{key:3,class:"modal-overlay",onClick:s[8]||(s[8]=de(t=>f.value=!1,["self"]))},[e("div",gt,[s[26]||(s[26]=e("h3",null,"Add Flag",-1)),e("div",ft,[s[21]||(s[21]=e("label",null,"Flag Type",-1)),b(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>y.value.type=t),type:"text",placeholder:"e.g., suspicious, vip, warning"},null,512),[[S,y.value.type]])]),e("div",kt,[s[22]||(s[22]=e("label",null,"Label",-1)),b(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>y.value.label=t),type:"text",placeholder:"Display label"},null,512),[[S,y.value.label]])]),e("div",xt,[s[23]||(s[23]=e("label",null,"Reason (optional)",-1)),b(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=t=>y.value.reason=t),placeholder:"Reason for flag"},null,512),[[S,y.value.reason]])]),e("div",wt,[s[25]||(s[25]=e("label",null,"Severity",-1)),b(e("select",{"onUpdate:modelValue":s[6]||(s[6]=t=>y.value.severity=t)},[...s[24]||(s[24]=[e("option",{value:"info"},"Info (Blue)",-1),e("option",{value:"success"},"Success (Green)",-1),e("option",{value:"warning"},"Warning (Yellow)",-1),e("option",{value:"danger"},"Danger (Red)",-1)])],512),[[K,y.value.severity]])]),e("div",Ct,[e("button",{onClick:s[7]||(s[7]=t=>f.value=!1),class:"btn btn-secondary"},"Cancel"),e("button",{onClick:Z,class:"btn btn-primary"},"Add Flag")])])])):u("",!0)])):u("",!0),v.value==="activity"?(a(),l("div",Tt,[s[28]||(s[28]=e("div",{class:"panel-header"},[e("h3",null,"Recent Activity")],-1)),J.value?(a(),l("div",Ft,"Loading activity...")):U.value.length?(a(),l("table",$t,[s[27]||(s[27]=e("thead",null,[e("tr",null,[e("th",null,"Type"),e("th",null,"Description"),e("th",null,"Time")])],-1)),e("tbody",null,[(a(!0),l(p,null,m(U.value,t=>(a(),l("tr",{key:t.id},[e("td",null,[e("span",{class:L(["badge",t.type])},n(t.type),3)]),e("td",null,n(t.description),1),e("td",null,n(N(t.created_at)),1)]))),128))])])):(a(),l("div",Ut,"No activity found"))])):u("",!0)])])):(a(),l("div",ke,[...s[10]||(s[10]=[e("div",{class:"text-6xl mb-4"},"ðŸ‘¤",-1),e("h3",{class:"text-xl text-slate-300 mb-2"},"No User Selected",-1),e("p",{class:"text-slate-500"},"Search for a user above to view their details",-1)])]))])}}},Vt=ae(Nt,[["__scopeId","data-v-b4c15938"]]);export{Vt as default};
