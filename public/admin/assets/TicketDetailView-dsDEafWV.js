import{_ as ie,e as ne,h as i,a as e,d as y,t as o,l as w,n as u,F as V,i as z,k as U,v as Q,M as re,j as ue,x as d,g as v,af as de,y as ve,u as ce,o as n}from"./index-D3jdM4om.js";const pe={class:"ticket-detail"},ge={class:"page-header"},me={key:0,class:"ticket-ref"},ke={key:0,class:"loading-state"},fe={key:1,class:"error-state"},ye={key:2,class:"ticket-layout"},we={class:"main-panel"},he={class:"info-card"},_e={class:"info-header"},be={class:"info-title"},Ce={class:"info-meta"},xe={class:"meta-item"},Me={class:"meta-item"},Te={class:"meta-item"},Be={key:0,class:"meta-item"},$e={class:"message-card original"},Ae={class:"message-avatar user"},Se={class:"message-content"},Ve={class:"message-header"},ze={class:"sender-name"},Ue={class:"message-time"},Fe={class:"message-body"},Le={key:0,class:"replies-section"},Re={class:"section-title"},De={class:"message-content"},He={class:"message-header"},Ne={class:"sender-name"},We={key:0,class:"staff-badge"},Ie={class:"message-time"},Oe={class:"message-body"},Pe={key:1,class:"reply-form"},je={class:"quick-replies-inline"},qe=["onClick"],Ee={class:"form-group"},Qe={class:"form-actions"},Ge={class:"checkbox-wrapper"},Je=["disabled"],Ke={key:2,class:"closed-notice"},Xe={class:"side-panel"},Ye={class:"panel-card"},Ze={class:"button-grid"},es={class:"panel-card"},ss={class:"button-grid"},ts={class:"panel-card"},as={key:0,class:"assignee-info"},ls={class:"assignee-avatar"},os={class:"assignee-name"},is={key:1,class:"assignee-actions"},ns={class:"modal-header"},rs={class:"modal-body"},us={class:"search-box"},ds={key:0,class:"staff-loading"},vs={key:1,class:"staff-empty"},cs={key:2,class:"staff-list"},ps=["onClick"],gs={class:"staff-avatar"},ms={class:"staff-info"},ks={class:"staff-name"},fs={class:"staff-email"},ys={__name:"TicketDetailView",setup(ws){const G=de(),F=ce(),r=ve(),b=v(!0),t=v(null),c=v(""),h=v(!1),C=v(!0),m=v(null),k=v(!1),x=v([]),M=v(""),T=v(!1);let L=null;const J=[{label:"Thanks for contacting",text:"Thank you for contacting support. We have received your ticket and will assist you shortly."},{label:"Issue resolved",text:"We have resolved the issue you reported. Please let us know if you need further assistance."},{label:"Need more info",text:"To help investigate further, could you please provide additional details about the issue?"},{label:"Working on it",text:"Our team is currently investigating this issue. We will update you soon."}],B=async()=>{b.value=!0;try{const l=await d.get(`/admin/support/tickets/${G.params.id}`);t.value=l.data.ticket||l.data.data||l.data}catch(l){console.error("Failed to fetch ticket:",l),r.error("Failed to load ticket"),t.value=null}finally{b.value=!1}},K=async()=>{try{const l=await d.get("/user");m.value=l.data}catch(l){console.error("Failed to fetch user:",l)}},R=()=>F.push("/tickets"),X=async()=>{if(c.value.trim()){h.value=!0;try{await d.post(`/admin/support/tickets/${t.value.id}/reply`,{message:c.value}),t.value.messages=t.value.messages||[],t.value.messages.push({id:Date.now(),message:c.value,is_admin:!0,user:m.value,created_at:new Date().toISOString()}),C.value&&t.value.status!=="answered"&&(t.value.status="answered",await d.patch(`/admin/support/tickets/${t.value.id}/status`,{status:"answered"})),c.value="",r.success("Reply sent")}catch{r.error("Failed to send reply")}finally{h.value=!1}}},f=async()=>{try{await d.patch(`/admin/support/tickets/${t.value.id}/status`,{status:t.value.status}),r.success("Status updated")}catch{r.error("Failed to update status"),B()}},_=async()=>{try{await d.patch(`/admin/support/tickets/${t.value.id}`,{priority:t.value.priority}),r.success("Priority updated")}catch{r.error("Failed to update priority"),B()}},Y=async()=>{var l,s;try{await d.patch(`/admin/support/tickets/${t.value.id}/assign`,{assigned_to:(l=m.value)==null?void 0:l.id}),t.value.assigned_to=(s=m.value)==null?void 0:s.id,t.value.assigned_user=m.value,r.success("Ticket assigned to you")}catch{r.error("Failed to assign ticket")}},Z=async()=>{try{await d.patch(`/admin/support/tickets/${t.value.id}/assign`,{assigned_to:null}),t.value.assigned_to=null,t.value.assigned_user=null,r.success("Ticket unassigned")}catch{r.error("Failed to unassign ticket")}},D=async(l="")=>{T.value=!0;try{const s=await d.get("/admin/support/tickets/staff/users",{params:{search:l}});x.value=s.data.users||[]}catch(s){console.error("Failed to fetch staff:",s),r.error("Failed to load staff members")}finally{T.value=!1}},ee=()=>{clearTimeout(L),L=setTimeout(()=>{D(M.value)},300)},se=async l=>{try{await d.patch(`/admin/support/tickets/${t.value.id}/assign`,{assigned_to:l.id}),t.value.assigned_to=l.id,t.value.assigned_user=l,k.value=!1,r.success(`Ticket assigned to ${l.username}`)}catch{r.error("Failed to assign ticket")}},te=async()=>{t.value.status="open",await f()},ae=async()=>{if(confirm("Delete this ticket permanently?"))try{await d.delete(`/admin/support/tickets/${t.value.id}`),r.success("Ticket deleted"),F.push("/tickets")}catch{r.error("Failed to delete ticket")}},le=l=>{c.value=l},oe=l=>({open:"Open",waiting_response:"Waiting",answered:"Answered",closed:"Closed"})[l]||l,$=l=>l?new Date(l).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"";return ne(()=>{B(),K(),D()}),(l,s)=>{var A,H,N,W,I,O,P,j,q;return n(),i("div",pe,[e("div",ge,[e("button",{class:"back-btn",onClick:R},[...s[15]||(s[15]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),y(" Back ",-1)])]),t.value?(n(),i("span",me,"Ticket #"+o(t.value.id),1)):w("",!0)]),b.value?(n(),i("div",ke,[...s[16]||(s[16]=[e("div",{class:"spinner"},null,-1),e("span",null,"Loading ticket...",-1)])])):t.value?(n(),i("div",ye,[e("div",we,[e("div",he,[e("div",_e,[e("div",be,[e("h2",null,o(t.value.subject),1),e("span",{class:u(["priority-tag",t.value.priority])},o(t.value.priority),3)]),e("span",{class:u(["status-tag",t.value.status])},o(oe(t.value.status)),3)]),e("div",Ce,[e("div",xe,[s[20]||(s[20]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1)),e("span",null,o(((A=t.value.user)==null?void 0:A.username)||"Unknown"),1)]),e("div",Me,[s[21]||(s[21]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),e("path",{d:"m22 6-10 7L2 6"})],-1)),e("span",null,o(((H=t.value.user)==null?void 0:H.email)||"No email"),1)]),e("div",Te,[s[22]||(s[22]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),e("path",{d:"M16 2v4M8 2v4M3 10h18"})],-1)),e("span",null,o($(t.value.created_at)),1)]),t.value.category?(n(),i("div",Be,[s[23]||(s[23]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})],-1)),e("span",null,o((N=t.value.category)==null?void 0:N.name),1)])):w("",!0)])]),e("div",$e,[e("div",Ae,o(((O=(I=(W=t.value.user)==null?void 0:W.username)==null?void 0:I.charAt(0))==null?void 0:O.toUpperCase())||"?"),1),e("div",Se,[e("div",Ve,[e("span",ze,o(((P=t.value.user)==null?void 0:P.username)||"User"),1),e("span",Ue,o($(t.value.created_at)),1)]),e("div",Fe,o(t.value.description||t.value.message),1)])]),t.value.messages&&t.value.messages.length>0?(n(),i("div",Le,[e("h4",Re,[s[24]||(s[24]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})],-1)),y(" "+o(t.value.messages.length)+" "+o(t.value.messages.length===1?"Reply":"Replies"),1)]),(n(!0),i(V,null,z(t.value.messages,a=>{var p,g,S,E;return n(),i("div",{key:a.id,class:u(["message-card",{admin:a.is_admin||a.is_staff_reply}])},[e("div",{class:u(["message-avatar",a.is_admin||a.is_staff_reply?"admin":"user"])},o(((S=(g=(p=a.user)==null?void 0:p.username)==null?void 0:g.charAt(0))==null?void 0:S.toUpperCase())||"?"),3),e("div",De,[e("div",He,[e("span",Ne,[y(o(((E=a.user)==null?void 0:E.username)||"Unknown")+" ",1),a.is_admin||a.is_staff_reply?(n(),i("span",We,"Staff")):w("",!0)]),e("span",Ie,o($(a.created_at)),1)]),e("div",Oe,o(a.message),1)])],2)}),128))])):w("",!0),t.value.status!=="closed"?(n(),i("div",Pe,[s[26]||(s[26]=e("h4",{class:"section-title"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})]),y(" Send Reply ")],-1)),e("div",je,[(n(),i(V,null,z(J,(a,p)=>e("button",{key:p,onClick:g=>le(a.text),class:"quick-reply-btn"},o(a.label),9,qe)),64))]),e("div",Ee,[U(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=a=>c.value=a),placeholder:"Type your response...",rows:"4"},null,512),[[Q,c.value]])]),e("div",Qe,[e("label",Ge,[U(e("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=a=>C.value=a)},null,512),[[re,C.value]]),s[25]||(s[25]=e("span",null,"Mark as answered",-1))]),e("button",{class:"btn-primary",onClick:X,disabled:!c.value.trim()||h.value},o(h.value?"Sending...":"Send Reply"),9,Je)])])):(n(),i("div",Ke,[s[27]||(s[27]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)),s[28]||(s[28]=e("p",null,"This ticket is closed",-1)),e("button",{class:"btn-secondary",onClick:te},"Reopen Ticket")]))]),e("div",Xe,[e("div",Ye,[s[33]||(s[33]=e("h5",null,"Status",-1)),e("div",Ze,[e("button",{class:u(["status-btn",{active:t.value.status==="open","status-open":t.value.status==="open"}]),onClick:s[2]||(s[2]=a=>{t.value.status="open",f()})},[...s[29]||(s[29]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule":"evenodd"})],-1),e("span",null,"Open",-1)])],2),e("button",{class:u(["status-btn",{active:t.value.status==="waiting_response","status-waiting":t.value.status==="waiting_response"}]),onClick:s[3]||(s[3]=a=>{t.value.status="waiting_response",f()})},[...s[30]||(s[30]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z","clip-rule":"evenodd"})],-1),e("span",null,"Waiting",-1)])],2),e("button",{class:u(["status-btn",{active:t.value.status==="answered","status-answered":t.value.status==="answered"}]),onClick:s[4]||(s[4]=a=>{t.value.status="answered",f()})},[...s[31]||(s[31]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M3.505 2.365A41.369 41.369 0 019 2c1.863 0 3.697.124 5.495.365 1.247.167 2.18 1.108 2.435 2.268a4.45 4.45 0 00-.577-.069 43.141 43.141 0 00-4.706 0C9.229 4.696 7.5 6.727 7.5 8.998v2.24c0 1.413.67 2.735 1.76 3.562l-2.98 2.98A.75.75 0 015 17.25v-3.443c-.501-.048-1-.106-1.495-.172C2.033 13.438 1 12.162 1 10.72V5.28c0-1.441 1.033-2.717 2.505-2.914z"}),e("path",{d:"M14 6c-.762 0-1.52.02-2.271.062C10.157 6.148 9 7.472 9 8.998v2.24c0 1.519 1.147 2.839 2.71 2.935.214.013.428.024.642.034.2.009.385.09.518.224l2.35 2.35a.75.75 0 001.28-.531v-2.07c1.453-.195 2.5-1.463 2.5-2.915V8.998c0-1.526-1.157-2.85-2.729-2.936A41.645 41.645 0 0014 6z"})],-1),e("span",null,"Answered",-1)])],2),e("button",{class:u(["status-btn",{active:t.value.status==="closed","status-closed":t.value.status==="closed"}]),onClick:s[5]||(s[5]=a=>{t.value.status="closed",f()})},[...s[32]||(s[32]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z","clip-rule":"evenodd"})],-1),e("span",null,"Closed",-1)])],2)])]),e("div",es,[s[38]||(s[38]=e("h5",null,"Priority",-1)),e("div",ss,[e("button",{class:u(["priority-btn",{active:t.value.priority==="low","priority-low":t.value.priority==="low"}]),onClick:s[6]||(s[6]=a=>{t.value.priority="low",_()})},[...s[34]||(s[34]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z","clip-rule":"evenodd"})],-1),e("span",null,"Low",-1)])],2),e("button",{class:u(["priority-btn",{active:t.value.priority==="medium","priority-medium":t.value.priority==="medium"}]),onClick:s[7]||(s[7]=a=>{t.value.priority="medium",_()})},[...s[35]||(s[35]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 3a.75.75 0 01.55.24l3.25 3.5a.75.75 0 11-1.1 1.02L10 4.852 7.3 7.76a.75.75 0 01-1.1-1.02l3.25-3.5A.75.75 0 0110 3zm-3.76 9.2a.75.75 0 011.06.04l2.7 2.908 2.7-2.908a.75.75 0 111.1 1.02l-3.25 3.5a.75.75 0 01-1.1 0l-3.25-3.5a.75.75 0 01.04-1.06z","clip-rule":"evenodd"})],-1),e("span",null,"Medium",-1)])],2),e("button",{class:u(["priority-btn",{active:t.value.priority==="high","priority-high":t.value.priority==="high"}]),onClick:s[8]||(s[8]=a=>{t.value.priority="high",_()})},[...s[36]||(s[36]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z","clip-rule":"evenodd"})],-1),e("span",null,"High",-1)])],2),e("button",{class:u(["priority-btn",{active:t.value.priority==="urgent","priority-urgent":t.value.priority==="urgent"}]),onClick:s[9]||(s[9]=a=>{t.value.priority="urgent",_()})},[...s[37]||(s[37]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 103 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 002.273 1.765 11.842 11.842 0 00.976.544l.062.029.018.008.006.003zM10 11.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z","clip-rule":"evenodd"})],-1),e("span",null,"Urgent",-1)])],2)])]),e("div",ts,[s[40]||(s[40]=e("h5",null,"Assigned To",-1)),t.value.assigned_user?(n(),i("div",as,[e("div",ls,o((q=(j=t.value.assigned_user.username)==null?void 0:j.charAt(0))==null?void 0:q.toUpperCase()),1),e("span",os,o(t.value.assigned_user.username),1),e("button",{class:"btn-icon",onClick:Z,title:"Remove"},[...s[39]||(s[39]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])):(n(),i("div",is,[e("button",{class:"btn-outline full",onClick:Y}," Assign to Me "),e("button",{class:"btn-outline full",onClick:s[10]||(s[10]=a=>k.value=!0)}," Assign to Staff ")]))]),e("div",{class:"panel-card danger"},[s[42]||(s[42]=e("h5",null,"Actions",-1)),e("button",{class:"btn-danger full",onClick:ae},[...s[41]||(s[41]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})],-1),y(" Delete Ticket ",-1)])])])])])):(n(),i("div",fe,[s[17]||(s[17]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 8v4M12 16h.01"})],-1)),s[18]||(s[18]=e("h3",null,"Ticket not found",-1)),s[19]||(s[19]=e("p",null,"This ticket may have been deleted",-1)),e("button",{class:"btn-primary",onClick:R},"Return to Tickets")])),k.value?(n(),i("div",{key:3,class:"modal-overlay",onClick:s[14]||(s[14]=a=>k.value=!1)},[e("div",{class:"modal-content",onClick:s[13]||(s[13]=ue(()=>{},["stop"]))},[e("div",ns,[s[44]||(s[44]=e("h3",null,"Assign Ticket",-1)),e("button",{class:"btn-icon",onClick:s[11]||(s[11]=a=>k.value=!1)},[...s[43]||(s[43]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])]),e("div",rs,[e("div",us,[s[45]||(s[45]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"m21 21-4.35-4.35"})],-1)),U(e("input",{"onUpdate:modelValue":s[12]||(s[12]=a=>M.value=a),onInput:ee,type:"text",placeholder:"Search staff by name or email...",class:"search-input"},null,544),[[Q,M.value]])]),T.value?(n(),i("div",ds,[...s[46]||(s[46]=[e("div",{class:"spinner"},null,-1),e("span",null,"Searching...",-1)])])):x.value.length===0?(n(),i("div",vs,[...s[47]||(s[47]=[e("p",null,"No staff members found",-1)])])):(n(),i("div",cs,[(n(!0),i(V,null,z(x.value,a=>{var p,g;return n(),i("button",{key:a.id,onClick:S=>se(a),class:"staff-item"},[e("div",gs,o((g=(p=a.username)==null?void 0:p.charAt(0))==null?void 0:g.toUpperCase()),1),e("div",ms,[e("span",ks,o(a.username),1),e("span",fs,o(a.email),1)])],8,ps)}),128))]))])])])):w("",!0)])}}},_s=ie(ys,[["__scopeId","data-v-4c3a1e17"]]);export{_s as default};
