import{_ as W,e as G,h as n,a as e,d as C,n as F,t as o,l as u,F as k,i as h,j as U,y as f,g as m,q as T,s as H,o as a}from"./index-Dl3uBojK.js";const J={class:"modules-page"},O={class:"modules-header"},Q={class:"header-actions"},X={class:"tabs"},Y={key:0,class:"loading"},ss={key:1,class:"modules-grid"},es={key:0,class:"no-modules"},ls={class:"module-header"},ts={class:"module-icon"},ns={class:"module-info"},as={class:"module-meta"},os={class:"version"},is={key:0,class:"author"},ds={class:"module-status"},us={class:"module-description"},rs={key:0,class:"dependencies"},cs={class:"module-actions"},vs=["onClick"],ps=["onClick"],gs=["onClick"],ms={key:2,class:"modules-grid"},bs={key:0,class:"no-modules"},fs={class:"module-header"},ys={class:"module-icon"},_s={class:"module-info"},ks={class:"module-meta"},hs={class:"version"},Ms={key:0,class:"author"},Cs={key:0,class:"upgrade-badge"},ws={class:"module-description"},$s={key:0,class:"dependencies"},Fs={class:"module-actions"},Us=["onClick"],Ds=["onClick"],zs={key:3,class:"modules-grid"},Is={key:0,class:"no-modules"},Bs={class:"module-header"},Ns={class:"module-icon"},Ts={class:"module-info"},Ss={class:"module-meta"},Ps={class:"version"},Vs={key:0,class:"author"},xs={class:"module-description"},Es={key:0,class:"dependencies"},Zs={class:"module-actions"},Rs=["onClick"],Ls=["onClick"],js={class:"modal-header"},qs={class:"modal-body"},As={key:0,class:"file-info"},Ks={class:"file-size"},Ws={class:"modal-footer"},Gs=["disabled"],Hs={class:"modal-header"},Js={class:"modal-body"},Os={class:"modal-footer"},Qs={__name:"ModulesView",setup(Xs){const{success:b,error:c}=H(),w=m([]),D=m(!0),v=m("installed"),y=m(!1),_=m(!1),p=m(null),$=m(!1),M=m(null),P=m(null),z=T(()=>w.value.filter(t=>t.status==="installed")),I=T(()=>w.value.filter(t=>t.status==="staging")),B=T(()=>w.value.filter(t=>t.status==="disabled")),N=t=>({module:"ðŸŽ®",theme:"ðŸŽ¨",plugin:"ðŸ”Œ"})[t]||"ðŸ“¦",g=async()=>{D.value=!0;try{const t=await f.get("/admin/modules");w.value=t.data.modules||[]}catch(t){console.error("Failed to load modules:",t),c("Failed to load modules")}finally{D.value=!1}},V=async t=>{var s,i;try{await f.put(`/admin/modules/${t}/enable`),b("Module enabled"),await g()}catch(l){console.error("Failed to enable module:",l),c(((i=(s=l.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to enable module")}},x=async t=>{try{await f.put(`/admin/modules/${t}/disable`),b("Module disabled"),await g()}catch(s){console.error("Failed to disable module:",s),c("Failed to disable module")}},E=async t=>{var s,i;try{await f.post(`/admin/modules/${t}/install`),b("Module installed successfully"),await g()}catch(l){console.error("Failed to install module:",l),c(((i=(s=l.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to install module")}},S=t=>{M.value=t,_.value=!0},Z=async()=>{var t,s;if(M.value)try{await f.delete(`/admin/modules/${M.value.slug}`),b("Module uninstalled successfully"),_.value=!1,M.value=null,await g()}catch(i){console.error("Failed to uninstall module:",i),c(((s=(t=i.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to uninstall module")}},R=t=>{const s=t.target.files[0];if(s){if(s.size>10*1024*1024){c("File size must be less than 10MB");return}p.value=s}},L=t=>{const s=t.dataTransfer.files[0];if(s&&s.name.endsWith(".zip")){if(s.size>10*1024*1024){c("File size must be less than 10MB");return}p.value=s}else c("Please upload a ZIP file")},j=async()=>{var s,i;if(!p.value)return;$.value=!0;const t=new FormData;t.append("file",p.value),t.append("type","module");try{const r=(await f.post("/admin/modules/upload",t,{headers:{"Content-Type":"multipart/form-data"}})).data;r.is_upgrade?b(`Module uploaded to staging. Upgrade available: v${r.current_version} â†’ v${r.new_version}`):b("Module uploaded to staging successfully"),v.value="staging",y.value=!1,p.value=null,await g()}catch(l){console.error("Failed to upload module:",l),c(((i=(s=l.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to upload module")}finally{$.value=!1}},q=async t=>{var s,i;try{await f.put(`/admin/modules/${t}/reactivate`),b("Module reactivated successfully"),await g()}catch(l){console.error("Failed to reactivate module:",l),c(((i=(s=l.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to reactivate module")}},A=async t=>{var s,i;try{await f.delete(`/admin/modules/${t}/staging`),b("Module removed from staging"),await g()}catch(l){console.error("Failed to remove from staging:",l),c(((i=(s=l.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to remove from staging")}},K=t=>{if(t===0)return"0 Bytes";const s=1024,i=["Bytes","KB","MB"],l=Math.floor(Math.log(t)/Math.log(s));return Math.round(t/Math.pow(s,l)*100)/100+" "+i[l]};return G(()=>{g()}),(t,s)=>{var i;return a(),n("div",J,[e("div",O,[s[16]||(s[16]=e("h1",null,"ðŸ“¦ Module Manager",-1)),e("div",Q,[e("button",{class:"btn-secondary",onClick:s[0]||(s[0]=l=>y.value=!0)},[...s[14]||(s[14]=[e("span",null,"â¬†ï¸",-1),C(" Upload Module ",-1)])]),e("button",{class:"btn-primary",onClick:g},[...s[15]||(s[15]=[e("span",null,"ðŸ”„",-1),C(" Refresh ",-1)])])])]),e("div",X,[e("button",{class:F({active:v.value==="installed"}),onClick:s[1]||(s[1]=l=>v.value="installed")}," Installed Modules ("+o(z.value.length)+") ",3),e("button",{class:F({active:v.value==="staging"}),onClick:s[2]||(s[2]=l=>v.value="staging")}," Staging ("+o(I.value.length)+") ",3),e("button",{class:F({active:v.value==="disabled"}),onClick:s[3]||(s[3]=l=>v.value="disabled")}," Disabled Modules ("+o(B.value.length)+") ",3)]),D.value?(a(),n("div",Y,[...s[17]||(s[17]=[e("div",{class:"spinner"},null,-1),C(" Loading modules... ",-1)])])):v.value==="installed"?(a(),n("div",ss,[z.value.length===0?(a(),n("div",es,[...s[18]||(s[18]=[e("p",null,"No modules installed.",-1),e("p",{class:"hint"},"Upload a module ZIP file to get started.",-1)])])):u("",!0),(a(!0),n(k,null,h(z.value,l=>{var r;return a(),n("div",{key:l.slug,class:"module-card installed"},[e("div",ls,[e("div",ts,o(N(l.type)),1),e("div",ns,[e("h3",null,o(l.name),1),e("div",as,[e("span",os,"v"+o(l.version),1),l.author?(a(),n("span",is,"by "+o(l.author),1)):u("",!0)])]),e("div",ds,[e("span",{class:F(["badge",l.enabled?"badge-success":"badge-disabled"])},o(l.enabled?"Enabled":"Disabled"),3)])]),e("p",us,o(l.description||"No description available"),1),(r=l.dependencies)!=null&&r.length?(a(),n("div",rs,[s[19]||(s[19]=e("strong",null,"Dependencies:",-1)),(a(!0),n(k,null,h(l.dependencies,d=>(a(),n("span",{key:d,class:"dep-tag"},o(d),1))),128))])):u("",!0),e("div",cs,[l.enabled?(a(),n("button",{key:0,class:"btn-action btn-warning",onClick:d=>x(l.slug)}," Disable ",8,vs)):(a(),n("button",{key:1,class:"btn-action btn-success",onClick:d=>V(l.slug)}," Enable ",8,ps)),e("button",{class:"btn-action btn-danger",onClick:d=>S(l)}," Uninstall ",8,gs)])])}),128))])):v.value==="staging"?(a(),n("div",ms,[I.value.length===0?(a(),n("div",bs,[...s[20]||(s[20]=[e("p",null,"No modules in staging.",-1),e("p",{class:"hint"},"Upload module ZIP files to stage them for installation.",-1)])])):u("",!0),(a(!0),n(k,null,h(I.value,l=>{var r;return a(),n("div",{key:l.slug,class:"module-card staging"},[e("div",fs,[e("div",ys,o(N(l.type)),1),e("div",_s,[e("h3",null,o(l.name),1),e("div",ks,[e("span",hs,"v"+o(l.version),1),l.author?(a(),n("span",Ms,"by "+o(l.author),1)):u("",!0)]),l.is_upgrade?(a(),n("div",Cs," âš ï¸ Upgrade: v"+o(l.current_version)+" â†’ v"+o(l.version),1)):u("",!0)])]),e("p",ws,o(l.description||"No description available"),1),(r=l.dependencies)!=null&&r.length?(a(),n("div",$s,[s[21]||(s[21]=e("strong",null,"Dependencies:",-1)),(a(!0),n(k,null,h(l.dependencies,d=>(a(),n("span",{key:d,class:"dep-tag"},o(d),1))),128))])):u("",!0),e("div",Fs,[e("button",{class:"btn-action btn-primary",onClick:d=>E(l.slug)},o(l.is_upgrade?"Upgrade":"Install"),9,Us),e("button",{class:"btn-action btn-danger",onClick:d=>A(l.slug)}," Remove ",8,Ds)])])}),128))])):v.value==="disabled"?(a(),n("div",zs,[B.value.length===0?(a(),n("div",Is,[...s[22]||(s[22]=[e("p",null,"No disabled modules.",-1)])])):u("",!0),(a(!0),n(k,null,h(B.value,l=>{var r;return a(),n("div",{key:l.slug,class:"module-card disabled"},[e("div",Bs,[e("div",Ns,o(N(l.type)),1),e("div",Ts,[e("h3",null,o(l.name),1),e("div",Ss,[e("span",Ps,"v"+o(l.version),1),l.author?(a(),n("span",Vs,"by "+o(l.author),1)):u("",!0)])]),s[23]||(s[23]=e("div",{class:"module-status"},[e("span",{class:"badge badge-disabled"},"Disabled")],-1))]),e("p",xs,o(l.description||"No description available"),1),(r=l.dependencies)!=null&&r.length?(a(),n("div",Es,[s[24]||(s[24]=e("strong",null,"Dependencies:",-1)),(a(!0),n(k,null,h(l.dependencies,d=>(a(),n("span",{key:d,class:"dep-tag"},o(d),1))),128))])):u("",!0),e("div",Zs,[e("button",{class:"btn-action btn-success",onClick:d=>q(l.slug)}," Reactivate ",8,Rs),e("button",{class:"btn-action btn-danger",onClick:d=>S(l)}," Delete ",8,Ls)])])}),128))])):u("",!0),y.value?(a(),n("div",{key:4,class:"modal-overlay",onClick:s[9]||(s[9]=l=>y.value=!1)},[e("div",{class:"modal",onClick:s[8]||(s[8]=U(()=>{},["stop"]))},[e("div",js,[s[25]||(s[25]=e("h2",null,"Upload Module",-1)),e("button",{class:"btn-close",onClick:s[4]||(s[4]=l=>y.value=!1)},"Ã—")]),e("div",qs,[e("div",{class:"upload-area",onDragover:s[6]||(s[6]=U(()=>{},["prevent"])),onDrop:U(L,["prevent"])},[e("input",{ref_key:"fileInput",ref:P,type:"file",accept:".zip",onChange:R,style:{display:"none"}},null,544),e("div",{class:"upload-prompt",onClick:s[5]||(s[5]=l=>t.$refs.fileInput.click())},[...s[26]||(s[26]=[e("span",{class:"upload-icon"},"ðŸ“¦",-1),e("p",null,"Click to select or drag & drop module ZIP file",-1),e("p",{class:"hint"},"Maximum file size: 10MB",-1)])])],32),p.value?(a(),n("div",As,[e("span",null,"ðŸ“„ "+o(p.value.name),1),e("span",Ks,o(K(p.value.size)),1)])):u("",!0)]),e("div",Ws,[e("button",{class:"btn-cancel",onClick:s[7]||(s[7]=l=>y.value=!1)},"Cancel"),e("button",{class:"btn-submit",disabled:!p.value||$.value,onClick:j},o($.value?"Uploading...":"Upload"),9,Gs)])])])):u("",!0),_.value?(a(),n("div",{key:5,class:"modal-overlay",onClick:s[13]||(s[13]=l=>_.value=!1)},[e("div",{class:"modal modal-confirm",onClick:s[12]||(s[12]=U(()=>{},["stop"]))},[e("div",Hs,[s[27]||(s[27]=e("h2",null,"Confirm Uninstall",-1)),e("button",{class:"btn-close",onClick:s[10]||(s[10]=l=>_.value=!1)},"Ã—")]),e("div",Js,[e("p",null,[s[28]||(s[28]=C("Are you sure you want to uninstall ",-1)),e("strong",null,o((i=M.value)==null?void 0:i.name),1),s[29]||(s[29]=C("?",-1))]),s[30]||(s[30]=e("p",{class:"warning"},"This will remove all module files and database entries. This action cannot be undone.",-1))]),e("div",Os,[e("button",{class:"btn-cancel",onClick:s[11]||(s[11]=l=>_.value=!1)},"Cancel"),e("button",{class:"btn-danger",onClick:Z},"Uninstall")])])])):u("",!0)])}}},se=W(Qs,[["__scopeId","data-v-0edf61b3"]]);export{se as default};
